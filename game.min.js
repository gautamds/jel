/* KEYGAMESNETWORK */ var SoundManager=(function(){function a(){this.soundEnabled=true;this.initiliazed=false;this.focus=true;this.wasSoundEnabled=true;this.wasPauseCall=false;this.soundsOnFrame=[];this.wasMusicPlay=false}a.prototype.onLostFocus=function(){};a.prototype.onFocus=function(){};a.prototype.init=function(){try{if(!this.initiliazed){if(!createjs.Sound.initializeDefaultPlugins()){return}this.initiliazed=true}}catch(b){}};a.prototype.isSoundEnabled=function(){return this.soundEnabled};a.prototype.setSoundEnabled=function(b){this.soundEnabled=b;try{createjs.Sound.setMute(!b)}catch(c){}};a.prototype.play=function(b,c){try{if(!c){c=1}if(this.initiliazed&&this.soundEnabled){return createjs.Sound.play(b,createjs.Sound.INTERRUPT_NONE,0,0,0,c)}}catch(d){}return null};a.prototype.playMusic=function(c){try{if(!c){c=1}if(this.initiliazed&&this.soundEnabled){if(!this.wasMusicPlay){this.wasMusicPlay=true;var b=createjs.Sound.play(a.SOUND_MUSIC,createjs.Sound.INTERRUPT_NONE,0,0,-1,c);if(b.playState=="playFailed"){this.wasMusicPlay=false;return null}}}}catch(d){}return null};a.prototype.update=function(){this.soundsOnFrame.length=0};a.prototype.playSinglePerFrame=function(b,c){if(this.soundsOnFrame.indexOf(b)==-1){this.soundsOnFrame.push(b);this.play(b,c)}};a.g_instance=new a();a.SOUND_MUSIC="music";a.SOUND_CLICK="click";a.SOUND_MATCH_1="match_1";a.SOUND_MATCH_2="match_2";a.SOUND_MATCH_3="match_3";a.SOUND_DROP_1="drop_1";a.SOUND_DROP_2="drop_2";a.SOUND_DROP_3="drop_3";a.SOUND_LINE="line";a.SOUND_KILL_COLOR="kill_color";a.SOUND_BOOM="boom";a.SOUND_WIN="win";a.SOUND_CONVERT="convert";a.SOUND_LOSE="lose";return a})();var StateManager=(function(){function a(b,h,f){var g=this;this.statesConstainer=new createjs.Container();this.isMouseDown=false;this.timeDevider=1;this.allLoaded=false;this.lastTime=0;a.g_instance=this;this.states=Array();this.canvas=document.getElementById("canvas");this.stage=new createjs.Stage(this.canvas);this.stage.autoClear=true;createjs.Touch.enable(this.stage);this.stage.enableMouseOver(5);createjs.Ticker.setFPS(60);createjs.Ticker.addEventListener("tick",function(i){return g.update(i)});if(Constants.DEBUG_MODE){document.onkeydown=function(i){return g.onKeyDown(i)};document.onkeyup=function(i){return g.onKeyUp(i)}}var c=new AssetsManager(b,h,f);a.g_instance.pushState(c);c.addEventListener(Constants.LOAD_COMPLETE,function(i){return g.allAssetsLoaded(i)});c.startDownLoad();this.stage.addChild(this.statesConstainer);Constants.PIXEL_RATIO=(window.devicePixelRatio?window.devicePixelRatio:1);if(Constants.g_isPC){window.onresize=(function(i){return g.forcedResize()})}else{if(viewporter.ACTIVE){window.addEventListener("viewportready",function(){return g.forcedResize()});window.addEventListener("viewportchange",function(){return g.forcedResize()})}else{window.addEventListener("orientationchange",function(){return g.forcedResize()})}}this.forcedResize();this.stage.addEventListener(Constants.MOUSE_MOVE,(function(i){return g.handleMouse(i)}));this.stage.addEventListener(Constants.MOUSE_DOWN,(function(i){return g.handleMouse(i)}));this.stage.addEventListener(Constants.MOUSE_UP,(function(i){return g.handleMouse(i)}));try{keyGamesAPI_SoundControl=function(e){SoundManager.g_instance.setSoundEnabled(e=="on")};keyGamesAPI_gameResize=function(e,i){console.log("keygames resize call",e,i);a.g_instance.onResize(e,i)};keyGamesAPI_gameRestart=function(){a.g_instance.restart()};keyGamesAPI_gamePause=function(e){a.g_instance.pause()}}catch(d){}}a.prototype.forcedResize=function(){try{a.g_instance.onResize(window.innerWidth,window.innerHeight)}catch(b){console.log("error window.frameElement.clientWidth")}};a.prototype.pause=function(){if(this.states.length!=0){this.states[this.states.length-1].pause()}};a.prototype.restart=function(){if(this.states.length!=0){this.states[this.states.length-1].restart()}};a.prototype.onResize=function(b,c){if(b<c){Constants.SCREEN_SCALE=b/Constants.ASSETS_WIDTH*Constants.PIXEL_RATIO}else{Constants.SCREEN_SCALE=Math.min(b/Constants.ASSETS_WIDTH,c/Constants.ASSETS_HEIGHT)*Constants.PIXEL_RATIO}Constants.SCREEN_HEIGHT=c/Constants.SCREEN_SCALE*Constants.PIXEL_RATIO;this.canvas.width=Constants.ASSETS_WIDTH*Constants.SCREEN_SCALE;this.canvas.height=c*Constants.PIXEL_RATIO;this.canvas.style.width=this.canvas.width/Constants.PIXEL_RATIO+"px";this.canvas.style.height=this.canvas.height/Constants.PIXEL_RATIO+"px";this.statesConstainer.scaleX=this.statesConstainer.scaleY=Constants.SCREEN_SCALE;this.canvas.style.marginLeft=(b-Constants.ASSETS_WIDTH*Constants.SCREEN_SCALE/Constants.PIXEL_RATIO)/2+"px";this.canvas.style.marginTop="0px"};a.prototype.allAssetsLoaded=function(b){var d=this;try{keyGamesAPI_loadingComplete()}catch(c){}b.target.removeEventListener(Constants.LOAD_COMPLETE,this.allAssetsLoaded);if(window.onpagehide){window.onpagehide=(function(f){return d.onLostFocus(f)})}if(window.onblur){window.onblur=(function(f){return d.onLostFocus(f)})}if(window.onpageshow){window.onpageshow=(function(f){return d.onFocus(f)})}if(window.onfocus){window.onfocus=(function(f){return d.onFocus(f)})}this.allLoaded=true;GameData.getInstance().load();this.changeState(new MainMenuState())};a.prototype.update=function(f){var c=createjs.Ticker.getTime();var g=(c-this.lastTime);this.lastTime=c;var e=g*0.001/this.timeDevider;SoundManager.g_instance.update();if(this.states.length!=0){var b=this.states[this.states.length-1];if(!b.isInitiliazed()){b.init()}b.update(e)}for(var d=0;d<this.states.length;d++){this.states[d].forceUpdate(e)}this.stage.update(f)};a.prototype.changeState=function(b){while(this.states.length!=0){this.popState()}this.pushState(b)};a.prototype.pushState=function(b){this.states.push(b);this.statesConstainer.addChild(b)};a.prototype.popState=function(){if(this.states.length!=0){this.states[this.states.length-1].cleanup();this.statesConstainer.removeChild(this.states[this.states.length-1]);this.states.pop();if(this.states.length!=0){this.states[this.states.length-1].resume()}}};a.prototype.onLostFocus=function(b){SoundManager.g_instance.onLostFocus()};a.prototype.onFocus=function(b){SoundManager.g_instance.onFocus()};a.prototype.handleMouse=function(c){if(this.states.length==0){return}c.preventDefault();var b=this.states[this.states.length-1];switch(c.type){case Constants.MOUSE_DOWN:if(this.allLoaded){SoundManager.g_instance.init();SoundManager.g_instance.playMusic(0.2)}this.isMouseDown=true;b.onMouseDown(c.stageX/Constants.SCREEN_SCALE,c.stageY/Constants.SCREEN_SCALE);break;case Constants.MOUSE_UP:this.isMouseDown=false;b.onMouseUp(c.stageX/Constants.SCREEN_SCALE,c.stageY/Constants.SCREEN_SCALE);break;case Constants.MOUSE_MOVE:if(this.isMouseDown){b.onMouseMove(c.stageX/Constants.SCREEN_SCALE,c.stageY/Constants.SCREEN_SCALE)}break}};a.prototype.onKeyDown=function(b){if(Constants.g_DEBUG){switch(b.keyCode){case 65:this.timeDevider=5;break;case 68:this.timeDevider=10;break}}};a.prototype.onKeyUp=function(b){if(Constants.g_DEBUG){switch(b.keyCode){case 65:this.timeDevider=1;break;case 68:this.timeDevider=1;break}}};return a})();var __extends=this.__extends||function(f,a){for(var e in a){if(a.hasOwnProperty(e)){f[e]=a[e]}}function c(){this.constructor=f}c.prototype=a.prototype;f.prototype=new c()};var GameState=(function(b){__extends(a,b);function a(){b.call(this);this.liveTime=0;this.gameObjects=new Array();this.gui=new Array();this.newGameObjects=new Array();this.initiliazed=false;this.consoleH=200;this.haveFill=false}a.prototype.consolePrint=function(d){var c=new createjs.Text(d,"bold 35px Arial","#000000");this.addChild(c);c.x=50;c.y=this.consoleH;this.consoleH+=40};a.prototype.isInitiliazed=function(){return this.initiliazed};a.prototype.onMouseDown=function(c,e){for(var d=0;d<this.gui.length;d++){this.gui[d].onMouseDown(c,e)}};a.prototype.onMouseMove=function(c,e){for(var d=0;d<this.gui.length;d++){this.gui[d].onMouseMove(c,e)}};a.prototype.onMouseUp=function(c,e){DNButton.wasHandlerOnThisFrame=false;for(var d=0;d<this.gui.length;d++){this.gui[d].onMouseUp(c,e)}};a.prototype.addGuiObject=function(c){this.gui.push(c);this.addGameObject(c)};a.prototype.update=function(d){this.liveTime+=d;this.newGameObjects=new Array();for(var c=0;c<this.gameObjects.length;c++){var e=this.gameObjects[c];e.update(d);if(e.isDead()){e.onDead()}else{this.newGameObjects.push(e)}}this.gameObjects=this.newGameObjects};a.prototype.forceUpdate=function(d){for(var c=0;c<this.gameObjects.length;c++){this.gameObjects[c].forceUpdate(d)}};a.prototype.addGameObject=function(c){this.gameObjects.push(c)};a.prototype.addGameObjectAt=function(d,c){this.gameObjects.push(d);if(c){c.addChild(d)}};a.prototype.addGameObjectAtPos=function(e,d,c,f){this.gameObjects.push(e);if(d){d.addChild(e);e.x=c;e.y=f}};a.prototype.cleanup=function(){};a.prototype.resume=function(){};a.prototype.init=function(){this.initiliazed=true};a.prototype.onOrientationChanged=function(c){};a.prototype.alignByCenter=function(){this.y=(Constants.SCREEN_HEIGHT-Constants.ASSETS_HEIGHT)/2;if(Constants.ASSETS_HEIGHT<Constants.SCREEN_HEIGHT&&!this.haveFill){this.haveFill=true;var f=AssetsManager.g_instance.getImage(Images.FILL);this.addChild(f);var e=AssetsManager.g_instance.getImage(Images.FILL);this.addChild(e);var c=100;var d=(Constants.SCREEN_HEIGHT-Constants.ASSETS_HEIGHT)/2;if(d>c){f.scaleY=(d/c);e.scaleY=(d/c);f.y=Constants.ASSETS_HEIGHT;e.y=-c*e.scaleY}else{f.y=Constants.ASSETS_HEIGHT;e.y=-c}}};a.prototype.loadLayout=function(g,e){for(var d=0;d<g.length;d++){var c=g[d];var f=this.loadGUIObject(c,e);if(c.children){this.loadLayout(c.children,f)}}};a.prototype.loadGUIObject=function(f,e){var c=f.x;var i=f.y;var d=f.name;var h=f.picture;var g;switch(f.type){case Layouts.TYPE_SKEW:g=new Skewer(h);break;case Layouts.TYPE_BUTTON:g=new DNButton(h);break;case Layouts.TYPE_STATIC_PICTURE:g=new DNStaticPicture(h);break;case Layouts.TYPE_PLACEHOLDER:g=new DNPlaceholder();break;case Layouts.TYPE_JELLY_BUTTON:g=new DNJellyButton(h);break;case Layouts.TYPE_TEXT_FIELD:g=new DNTextField(f.text,f.font,f.letter_dist);break}if(g){g.name=d;g.x=c;g.y=i;this.addGuiObject(g);e.addChild(g);g.scaleX=g.scaleY=(f.scale||1)}else{console.log("Parsing layout error. Cant find type: ",f.type)}return g};a.prototype.findGUIObject=function(c){for(var d=0;d<this.gui.length;d++){if(this.gui[d].name==c){return this.gui[d]}}return null};a.prototype.onPause=function(){};a.prototype.onResume=function(){};a.prototype.restart=function(){};a.prototype.pause=function(){};return a})(createjs.Container);var Constants=(function(){function a(){}a.g_DEBUG=false;a.LOAD_COMPLETE="LOAD_COMPLETE";a.MOUSE_DOWN="stagemousedown";a.MOUSE_UP="stagemouseup";a.MOUSE_MOVE="stagemousemove";a.CELL_SIZE=95;a.FIELD_OFFSET_X=-78;a.FIELD_OFFSET_Y=138;a.EXCHANGE_TIME=0.22;a.MATCH_TIME=0.25;a.GRAVITY_ACC=2500;a.ASSETS_WIDTH=700;a.ASSETS_HEIGHT=900;a.PIXEL_RATIO=1;a.SCREEN_HEIGHT=900;a.SCREEN_SCALE=1;a.DPI=-1;a.g_isPC=true;a.DEBUG_MODE=false;a.MATCH_DELAY=0.085;a.BONUS_COUNT_RAINBOW=5;a.BONUS_COUNT_HOR=9;a.BONUS_COUNT_VERT=10;a.BONUS_COUNT_BOMB=7;a.BONUS_COUNT_COLOR=11;return a})();var AssetsManager=(function(b){__extends(a,b);function a(c,e,d){b.call(this);this.loadingShape=new createjs.Shape();this.loadingShapeBack1=new createjs.Shape();this.loadingShapeBack2=new createjs.Shape();this.maxWidth=100;this.deltaY=50;this.imageNameToSpriteSheetName=new Object();this.logo=null;a.g_instance=this;this.athlases=d;document.getElementById("loader").className="loader";createjs.EventDispatcher.initialize(a.prototype);this.manifest=c;this.soundManifest=e;this.labelPercentDownload=new createjs.Text("Loading: 100%","bold 45px Times New Roman","#ffffff");this.labelPercentDownload.textAlign="center";this.addChild(this.labelPercentDownload);this.maxWidth=this.labelPercentDownload.getBounds().width;this.deltaY=this.labelPercentDownload.getBounds().height;this.loadingShapeBack1.graphics.beginFill("#888888");this.loadingShapeBack1.graphics.drawRect(0-4,0-4,this.maxWidth+8,this.deltaY+8);this.loadingShapeBack1.graphics.endFill();this.addChild(this.loadingShapeBack1);this.loadingShape.graphics.beginFill("#ffffff");this.loadingShape.graphics.drawRect(0,0,this.maxWidth,this.deltaY);this.loadingShape.graphics.endFill();this.addChild(this.loadingShape);this.loadingShape.scaleX=0;this.labelPercentDownload.x=Constants.ASSETS_WIDTH/2;this.labelPercentDownload.y=Constants.ASSETS_HEIGHT/2;this.loadingShape.x=this.labelPercentDownload.x-this.maxWidth/2;this.loadingShape.y=this.labelPercentDownload.y+this.deltaY*1.5;this.loadingShapeBack1.x=this.loadingShape.x;this.loadingShapeBack1.y=this.loadingShape.y}a.prototype.startDownLoad=function(){var c=this;this.loader=new createjs.LoadQueue();this.loader.addEventListener("progress",function(d){return c.handleProgress(d)});this.loader.addEventListener("complete",function(d){return c.handleComplete(d)});createjs.Sound.registerManifest(this.soundManifest,"assets/sound/");this.loader.installPlugin(createjs.SoundJS);this.loader.loadManifest(this.manifest)};a.prototype.handleProgress=function(c){var d=this;this.labelPercentDownload.text="Loading: "+(Math.max(Math.min(1, c.loaded), 0)*100).toFixed(0)+"%";this.loadingShape.scaleX=Math.max(Math.min(1, c.loaded), 0);if(this.logo==null&&this.getBitmap(Images.LOGO).getBounds()){this.logo=new DNJellyButton(Images.LOGO,function(){return d.onLogoClick()});this.addChild(this.logo);this.addGuiObject(this.logo);this.logo.x=this.labelPercentDownload.x;this.logo.y=this.labelPercentDownload.y-80}};a.prototype.onLogoClick=function(){Utils.goLogo()};a.prototype.handleComplete=function(e){this.removeChild(this.labelPercentDownload);for(var d=0;d<this.athlases.length;d++){var g=this.athlases[d];g.images=[this.getBitmap(g.images[0]).image];var f=new createjs.SpriteSheet(g);var h=f.getAnimations();for(var c=0;c<h.length;c++){this.imageNameToSpriteSheetName[h[c]]=f}}this.dispatchEvent(Constants.LOAD_COMPLETE,this);document.getElementById("loader").className=""};a.prototype.getResult=function(c){return this.loader.getResult(c)};a.prototype.getBitmap=function(c){var d=new createjs.Bitmap(this.loader.getResult(c));if(!d.getBounds()){console.log("bitmap error",c)}return d};a.prototype.getCenteredBitmap=function(c){var d=new createjs.Bitmap(this.loader.getResult(c));if(!d.image){console.log("ERROR HERE",c)}d.x=-d.image.width/2;d.y=-d.image.height/2;return d};a.prototype.getImage=function(c){if(this.imageNameToSpriteSheetName[c]){return this.getSprite(c)}return this.getBitmap(c)};a.prototype.getCenteredImage=function(c){var d=this.getImage(c);d.x=-d.getBounds().width/2;d.y=-d.getBounds().height/2;return d};a.prototype.getCenteredImageWithProxy=function(c){var d=new createjs.Container();d.addChild(this.getCenteredImage(c));return d};a.prototype.getCenteredBitmapWithProxy=function(c){var d=new createjs.Container();d.addChild(this.getCenteredBitmap(c));return d};a.prototype.getSprite=function(c){var d=new createjs.Sprite(this.imageNameToSpriteSheetName[c],c);d.stop();return d};a.prototype.getCenteredSprite=function(c){var d=this.getSprite(c);d.x=-d.getBounds().width/2;d.y=-d.getBounds().height/2;return d};return a})(GameState);var GameObject=(function(a){__extends(b,a);function b(){a.call(this);this.liveTime=0;this.forceLiveTime=0;this.killed=false}b.prototype.update=function(c){this.liveTime+=c};b.prototype.forceUpdate=function(c){this.forceLiveTime+=c};b.prototype.kill=function(){this.killed=true};b.prototype.isDead=function(){return this.killed};b.prototype.onDead=function(){if(this.parent){this.parent.removeChild(this)}};return b})(createjs.Container);var GUIObject=(function(b){__extends(a,b);function a(){b.apply(this,arguments)}a.prototype.onMouseDown=function(c,d){};a.prototype.onMouseUp=function(c,d){};a.prototype.onMouseMove=function(c,d){};a.prototype.setHandler=function(c){};return a})(GameObject);var Skewer=(function(b){__extends(a,b);function a(d){b.call(this);this.proxy=new createjs.Container();this.addChild(this.proxy);var c=AssetsManager.g_instance.getImage(d);c.x=-c.getBounds().width/2;c.y=-c.getBounds().height;this.proxy.addChild(c);this.proxy.y=c.getBounds().height*0.5}a.prototype.forceUpdate=function(c){b.prototype.forceUpdate.call(this,c);this.proxy.skewX=Math.sin(this.forceLiveTime*4)*6;this.proxy.scaleY=1+Math.sin(this.forceLiveTime*8)*0.05};return a})(GUIObject);var Chip=(function(a){__extends(b,a);function b(h,d,g,f,c){a.call(this);this.matchReason=null;this.state=null;this.wasClear=false;this.speed=new createjs.Point(0,0);this.acceleration=new createjs.Point(0,Constants.GRAVITY_ACC);this.rotationSpeed=0;this.selected=false;this.jellyScale=0;this.stateTime=0;this.fallDownDelay=Utils.RandomRange(0,0.75);this.bonusType=null;this.scaleMultiplier=Utils.RandomRange(11,16);this.bonusesToActivate=null;this.numInLine=0;this.convertToBonusQueryColor=-1;this.convertToBonusQuery=-1;this.convertionEffect=null;this.hole=false;this.evil=false;this.needLandSound=false;this.spawnYPos=f;this.setIncexes(d,g);if(h!=0&&h!=9){var e=0.9;this.chipPicture=AssetsManager.g_instance.getImage("jelly_"+h);this.chipPicture.scaleX=this.chipPicture.scaleY=e;this.addChild(this.chipPicture);this.chipPicture.x=-this.chipPicture.getBounds().width/2*e;this.chipPicture.y=-this.chipPicture.getBounds().height*e;this.chipPictureWake=AssetsManager.g_instance.getImage("jelly_"+h+"_wake");this.chipPictureWake.scaleX=this.chipPictureWake.scaleY=e;this.addChild(this.chipPictureWake);this.chipPictureWake.x=-this.chipPictureWake.getBounds().width/2*e;this.chipPictureWake.y=-this.chipPictureWake.getBounds().height*e;this.chipPictureWake.visible=false}this.colorID=h;this.setState(b.STATE_SPAWN_NEW);this.spawnDelay=c;if(h==9){this.convertToEvil()}}b.prototype.goDance=function(){if(this.colorID<0){return}if(!this.isBonus()){this.removeAllChildren();var c=0.9;this.chipPicture=AssetsManager.g_instance.getImage("jelly_"+this.colorID+"_happy");this.chipPicture.scaleX=this.chipPicture.scaleY=c;this.addChild(this.chipPicture);this.chipPicture.x=-this.chipPicture.getBounds().width/2*c;this.chipPicture.y=-this.chipPicture.getBounds().height*c}};b.prototype.getBonusType=function(){return this.bonusType};b.prototype.getColorID=function(){return this.colorID};b.prototype.getIndeces=function(){return new createjs.Point(this.indexX,this.indexY)};b.prototype.getIndexX=function(){return this.indexX};b.prototype.getIndexY=function(){return this.indexY};b.prototype.setIncexes=function(c,d){this.indexX=c;this.indexY=d};b.prototype.updateKinematic=function(c){this.speed.y+=this.acceleration.y*c;this.x+=c*this.speed.x;this.y+=c*this.speed.y;this.rotation+=this.rotationSpeed*c};b.prototype.update=function(d){a.prototype.update.call(this,d);this.stateTime+=d;switch(this.state){case b.STATE_DANCE:case b.STATE_NORMAL:if(this.jellyScale>0){var e=Math.sin(this.stateTime*this.scaleMultiplier)*this.jellyScale;this.scaleX=1+e;this.scaleY=1-e;this.jellyScale-=d*0.13;if(this.selected){if(this.jellyScale<0.015){this.jellyScale=0.015}}}break;case b.STATE_BEFORE_DEAD:var e=Math.sin(this.stateTime*25)*0.07;this.scaleX=1+e;this.scaleY=1-e;if(this.stateTime>0.8){this.match(b.REASON_EVIL_BEFORE_DEAD,0,0)}break;case b.STATE_SPAWN_NEW:this.spawnDelay-=d;if(this.spawnDelay<0){this.updateKinematic(d);if(this.y>=this.spawnYPos){this.jellyScale=0.13;this.y=this.spawnYPos;this.setState(b.STATE_NORMAL);PlayState.g_instance.onShiftEnded(this.needLandSound)}}break;case b.STATE_SHIFT_DOWN:this.updateKinematic(d);if(this.y>=this.spawnYPos){this.y=this.spawnYPos;this.setState(b.STATE_NORMAL);PlayState.g_instance.onShiftEnded(this.needLandSound);this.jellyScale=0.13}break;case b.STATE_FALL_DOWN:this.fallDownDelay-=d;if(this.fallDownDelay<=0){this.speed.y+=this.acceleration.y*d;this.x+=d*this.speed.x;this.y+=d*this.speed.y;this.rotation+=this.rotationSpeed*d;if(this.y>=1300){this.kill()}}break;case b.STATE_MATCH:if(this.stateTime>=0){this.alpha=1-this.stateTime/Constants.MATCH_TIME;if(this.stateTime>=Constants.MATCH_TIME/2&&!this.wasClear){PlayState.g_instance.onMatchSomething(this);if(this.matchReason!=b.REASON_BOMB){SoundManager.g_instance.playSinglePerFrame([SoundManager.SOUND_MATCH_1,SoundManager.SOUND_MATCH_2,SoundManager.SOUND_MATCH_3][Utils.RandomRangeInt(0,2)])}if(this.convertToBonusQuery>=Constants.BONUS_COUNT_RAINBOW&&!this.bonusesToActivate){this.convertToBonus(this.convertToBonusQuery);if(!this.isEvil()){PlayState.g_instance.tryClearDirt(this.indexX,this.indexY)}}else{PlayState.g_instance.addScore(this);PlayState.g_instance.addChild(this);PlayState.g_instance.clearCell(this);this.wasClear=true}if(this.bonusesToActivate){for(var c=0;c<this.bonusesToActivate.length;c++){PlayState.g_instance.matchBonus(this.bonusesToActivate[c],this.indexX,this.indexY,true)}this.bonusesToActivate=null}}if(this.stateTime>=Constants.MATCH_TIME){this.kill()}}break}if(this.shiningCircle){this.shiningCircle.rotation+=d*20}if(this.bonusType==b.BONUS_LINE_HOR||this.bonusType==b.BONUS_LINE_VERT){this.lineArrow1.x=-32+Math.sin(this.liveTime*9)*2;this.lineArrow2.x=+32-Math.sin(this.liveTime*9)*2}if(this.convertionEffect){this.convertionEffect.y=this.y-Constants.CELL_SIZE/2;if(this.convertionEffect.isDead()){this.convertionEffect=null}}if(this.colorEffect){this.colorEffect.rotation+=d*50}};b.prototype.setState=function(c){if(c==this.state){return}this.stateTime=0;this.state=c};b.prototype.shiftDown=function(d,c){this.speed=new createjs.Point(0,0);this.deselect();this.indexY=d;this.spawnYPos=c;this.setState(b.STATE_SHIFT_DOWN)};b.prototype.match=function(e,c,d){if(this.state==b.STATE_MATCH){return}if(this.isHole()){return}this.matchReason=e;if(this.isEvil()){if(this.state!=b.STATE_BEFORE_DEAD){this.removeAllChildren();SoundManager.g_instance.playSinglePerFrame("evil_"+Utils.RandomRangeInt(2,3),0.7);this.chipPicture=AssetsManager.g_instance.getImage(Images.EVIL_JELLY_DEAD);this.addChild(this.chipPicture);this.chipPicture.x=-this.chipPicture.getBounds().width/2;this.chipPicture.y=-this.chipPicture.getBounds().height;this.addChild(this.chipPicture);this.setState(b.STATE_BEFORE_DEAD);return}else{if(e!=b.REASON_EVIL_BEFORE_DEAD){return}}}this.numInLine=c;this.setState(b.STATE_MATCH);this.stateTime=-d};b.prototype.isSelected=function(){return this.selected};b.prototype.select=function(){this.chipPicture.visible=false;this.chipPictureWake.visible=true;this.selected=true;this.stateTime=0;this.jellyScale=0.11};b.prototype.deselect=function(){if(this.selected){this.chipPictureWake.visible=false;this.chipPicture.visible=true;this.selected=false}};b.prototype.isNormal=function(){return this.state==b.STATE_NORMAL};b.prototype.getState=function(){return this.state};b.prototype.isBonus=function(){return this.bonusType!=null};b.prototype.clearBonus=function(){this.bonusType=null};b.prototype.queryConvertToBonus=function(c){this.convertToBonusQuery=c};b.prototype.convertToBonus=function(e){this.convertToBonusQuery=-1;if(this.isBonus()){return}if(e>=Constants.BONUS_COUNT_RAINBOW){SoundManager.g_instance.play(SoundManager.SOUND_CONVERT)}if(e>=Constants.BONUS_COUNT_COLOR){this.convertToBonus(Constants.BONUS_COUNT_RAINBOW);this.deselect();this.bonusType=b.BONUS_COLOR;this.setState(b.STATE_NORMAL);this.alpha=1;this.colorEffect=AssetsManager.g_instance.getCenteredImageWithProxy(Images.BONUS_COLOR);this.colorEffect.y=-Constants.CELL_SIZE/2;this.colorEffect.scaleX=this.colorEffect.scaleY=0.9;this.addChild(this.colorEffect)}else{if(e>=Constants.BONUS_COUNT_VERT){this.deselect();this.bonusType=b.BONUS_LINE_VERT;this.setState(b.STATE_NORMAL);this.alpha=1;this.lineArrow1=AssetsManager.g_instance.getCenteredImageWithProxy(Images.BONUS_LINE);this.lineArrow2=AssetsManager.g_instance.getCenteredImageWithProxy(Images.BONUS_LINE);this.lineArrow2.scaleX=-1;var d=new createjs.Container();this.addChild(d);d.addChild(this.lineArrow1);d.addChild(this.lineArrow2);d.rotation=90;d.x=-Constants.CELL_SIZE/2;d.y=-Constants.CELL_SIZE/2;this.lineArrow1.y=-47;this.lineArrow1.x=-25;this.lineArrow2.y=-47;this.lineArrow2.x=+25}else{if(e>=Constants.BONUS_COUNT_HOR){this.deselect();this.bonusType=b.BONUS_LINE_HOR;this.setState(b.STATE_NORMAL);this.alpha=1;this.lineArrow1=AssetsManager.g_instance.getCenteredImageWithProxy(Images.BONUS_LINE);this.lineArrow2=AssetsManager.g_instance.getCenteredImageWithProxy(Images.BONUS_LINE);this.lineArrow2.scaleX=-1;this.addChild(this.lineArrow1);this.addChild(this.lineArrow2);this.lineArrow1.y=-47;this.lineArrow1.x=-25;this.lineArrow2.y=-47;this.lineArrow2.x=+25}else{if(e>=Constants.BONUS_COUNT_BOMB){this.deselect();this.removeAllChildren();var c=this.getColorID();this.chipPicture=AssetsManager.g_instance.getImage("bomb_"+c);this.addChild(this.chipPicture);this.chipPicture.x=-this.chipPicture.getBounds().width/2;this.chipPicture.y=-this.chipPicture.getBounds().height;this.addChild(this.chipPicture);this.chipPictureWake=AssetsManager.g_instance.getImage("bomb_"+c+"_wake");this.addChild(this.chipPictureWake);this.chipPictureWake.x=-this.chipPictureWake.getBounds().width/2;this.chipPictureWake.y=-this.chipPictureWake.getBounds().height;this.addChild(this.chipPictureWake);this.chipPictureWake.visible=false;this.bonusType=b.BONUS_BOMB;this.setState(b.STATE_NORMAL);this.alpha=1}else{if(e>=Constants.BONUS_COUNT_RAINBOW){this.deselect();this.removeAllChildren();this.colorID=7;var f=0.9;this.chipPicture=AssetsManager.g_instance.getImage("jelly_"+this.getColorID());this.chipPicture.scaleX=this.chipPicture.scaleY=f;this.addChild(this.chipPicture);this.chipPicture.x=-this.chipPicture.getBounds().width/2*f;this.chipPicture.y=-this.chipPicture.getBounds().height*f;this.addChild(this.chipPicture);this.chipPictureWake=AssetsManager.g_instance.getImage("jelly_"+this.getColorID()+"_wake");this.chipPictureWake.scaleX=this.chipPictureWake.scaleY=f;this.addChild(this.chipPictureWake);this.chipPictureWake.x=-this.chipPictureWake.getBounds().width/2*f;this.chipPictureWake.y=-this.chipPictureWake.getBounds().height*f;this.addChild(this.chipPictureWake);this.chipPictureWake.visible=false;this.setState(b.STATE_NORMAL);this.alpha=1}}}}}this.convertionEffect=new AutoreleaseEffect("transform/",14,0.045);PlayState.g_instance.addGameObjectAtPos(this.convertionEffect,PlayState.g_instance.pointsLayer,this.x,this.y-Constants.CELL_SIZE/2)};b.prototype.fallDown=function(){this.setState(b.STATE_FALL_DOWN)};b.prototype.setBonusesToActivate=function(c){this.bonusesToActivate=c};b.prototype.isHole=function(){return this.hole};b.prototype.convertToHole=function(){this.removeAllChildren();this.hole=true;this.setState(b.STATE_NORMAL)};b.prototype.convertToEvil=function(){this.removeAllChildren();var c=AssetsManager.g_instance.getImage(Images.EVIL_JELLY);this.addChild(c);c.x=-c.getBounds().width/2;c.y=-c.getBounds().height;this.colorID=-1;this.evil=true};b.prototype.isEvil=function(){return this.evil};b.prototype.getNumInLine=function(){return this.numInLine};b.prototype.getBonusDamageZone=function(){var c=null;switch(this.bonusType){case b.BONUS_BOMB:break}return c};b.prototype.needPlaySound=function(){this.needLandSound=true};b.BONUS_BOMB="bomb";b.BONUS_RAINBOW="rainbow";b.BONUS_COLOR="color";b.BONUS_LINE_VERT="line_vert";b.BONUS_LINE_HOR="line_hor";b.STATE_SPAWN_NEW="STATE_SPAWN_NEW";b.STATE_NORMAL="STATE_NORMAL";b.STATE_SHIFT_DOWN="STATE_SHIFT_DOWN";b.STATE_MATCH="STATE_MATCH";b.STATE_BEFORE_DEAD="STATE_BEFORE_DEAD";b.STATE_FALL_DOWN="STATE_FALL_DOWN";b.STATE_DANCE="STATE_DANCE";b.REASON_EVIL_BEFORE_DEAD="REASON_EVIL_BEFORE_DEAD";b.REASON_BOMB="REASON_BOMB";return b})(GameObject);var Utils=(function(){function a(){}a.RandomRange=function(c,b){return c+(b-c)*Math.random()};a.RandomRangeInt=function(c,b){return Math.floor(Math.random()*(b-c+1))+c};a.IntToTimeString=function(d){var b=Math.floor(d/60);var f=b.toString();var e=d%60;var c;if(e<10){c="0"+e}else{c=e.toString()}return f+"d"+c};a.RadToGrad=function(b){return b*180/Math.PI};a.GradToRad=function(b){return b*Math.PI/180};a.IsMobileBrowser=function(){if(window.orientation!=undefined){return true}var b=false;(function(c){if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(c)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(c.substr(0,4))){b=true}})(navigator.userAgent||navigator.vendor||window.opera);return b;return false};a.ScaledOffset=function(b){return(window.devicePixelRatio?window.devicePixelRatio:1)*b/Constants.SCREEN_SCALE};a.LineIntersectCircle=function(j,h,d,c){var n=(h.x-j.x)*(h.x-j.x)+(h.y-j.y)*(h.y-j.y);var m=2*((h.x-j.x)*(j.x-d.x)+(h.y-j.y)*(j.y-d.y));var k=d.x*d.x+d.y*d.y+j.x*j.x+j.y*j.y-2*(d.x*j.x+d.y*j.y)-c*c;var f=m*m-4*n*k;if(f>0){var l=Math.sqrt(f);var i=(-m+l)/(2*n);var g=(-m-l)/(2*n);if((i<0||i>1)&&(g<0||g>1)){return false}else{return true}}return false};a.ScoreString=function(c){var b=c.toString();switch(b.length){case 1:b="00000"+b;break;case 2:b="0000"+b;break;case 3:b="000"+b;break;case 4:b="00"+b;break;case 5:b="0"+b;break;case 6:break}return b};a.goMoreGames=function(){try{}catch(b){}};a.goLogo=function(){try{}catch(b){}};a.prototype.getDomainName=function(b){return b.substring(b.lastIndexOf(".",b.lastIndexOf(".")-1)+1)};return a})();var MainMenuState=(function(b){__extends(a,b);function a(){var c=this;b.call(this);this.loadLayout(Layouts.MAIN_MENU_LAYOUT,this);this.findGUIObject(Layouts.NAME_BUTTON_PLAY).setHandler(function(){return c.onPlayTouch()});this.findGUIObject(Layouts.NAME_BUTTON_CREDITS).setHandler(function(){return c.onCreditsTouch()});this.findGUIObject(Layouts.NAME_BUTTON_CREDITS).setHandler(function(){return c.onCreditsTouch()});this.findGUIObject(Layouts.NAME_BUTTON_LOGO).setHandler(function(){return c.onLogoTouch()});this.findGUIObject(Layouts.NAME_BUTTON_MORE_GAMES).setHandler(function(){return c.onLogoTouch()});this.setSoundButton();this.alignByCenter()}a.prototype.onSoundTouch=function(){SoundManager.g_instance.setSoundEnabled(!SoundManager.g_instance.isSoundEnabled());this.setSoundButton()};a.prototype.setSoundButton=function(){var d=this;if(this.soundButton&&this.soundButton.parent){this.soundButton.parent.removeChild(this.soundButton)}var c=SoundManager.g_instance.isSoundEnabled();this.soundButton=new DNJellyButton(c?Images.BUTTON_SOUND_ON:Images.BUTTON_SOUND_OFF,function(){return d.onSoundTouch()});this.addChild(this.soundButton);this.addGuiObject(this.soundButton);this.soundButton.x=this.findGUIObject(Layouts.NAME_SOUND_PLACE).x;this.soundButton.y=this.findGUIObject(Layouts.NAME_SOUND_PLACE).y;this.soundButton.scaleX=this.soundButton.scaleY=0.8};a.prototype.onLogoTouch=function(){Utils.goLogo()};a.prototype.onCreditsTouch=function(){StateManager.g_instance.pushState(new CreditsState())};a.prototype.onPlayTouch=function(){StateManager.g_instance.pushState(new ShadeInState(new SelectLevelState()))};a.prototype.onScoreTouch=function(){try{keyGamesAPI_gameOver()}catch(c){}};a.prototype.update=function(c){b.prototype.update.call(this,c);this.alignByCenter()};a.wasFullScreenToggle=false;return a})(GameState);var ShadeInState=(function(b){__extends(a,b);function a(c){var d=this;b.call(this);this.nextState=null;this.nextState=c;this.shader=new createjs.Shape();this.shader.graphics.beginFill("#ffffff");this.shader.graphics.drawRect(0,0,Constants.ASSETS_WIDTH,Constants.SCREEN_HEIGHT);this.shader.graphics.endFill();this.addChild(this.shader);this.shader.alpha=0;createjs.Tween.get(this.shader).to({alpha:1},400,createjs.Ease.linear).call(function(){return d.onFinishShade()})}a.prototype.onFinishShade=function(){StateManager.g_instance.changeState(this.nextState);StateManager.g_instance.pushState(new ShadeOutState())};a.prototype.setNextState=function(c){this.nextState=c};return a})(GameState);var ShadeOutState=(function(b){__extends(a,b);function a(){var c=this;b.call(this);this.shader=new createjs.Shape();this.shader.graphics.beginFill("#ffffff");this.shader.graphics.drawRect(0,0,Constants.ASSETS_WIDTH,Constants.SCREEN_HEIGHT);this.shader.graphics.endFill();this.addChild(this.shader);createjs.Tween.get(this.shader).to({alpha:0},400,createjs.Ease.linear).call(function(){return c.onFinishShade()})}a.prototype.onFinishShade=function(){StateManager.g_instance.popState()};return a})(GameState);var CreditsState=(function(a){__extends(b,a);function b(){a.call(this);this.hiddingNow=false;this.shader=new createjs.Shape();this.shader.graphics.beginFill("#ffffff");this.shader.graphics.drawRect(0,0,Constants.ASSETS_WIDTH,Constants.SCREEN_HEIGHT);this.shader.graphics.endFill();this.addChild(this.shader);this.shader.alpha=0;createjs.Tween.get(this.shader).to({alpha:0.85},500,createjs.Ease.linear);this.container=new createjs.Container();this.addChild(this.container);this.container.alpha=0;createjs.Tween.get(this.container).to({alpha:1},500,createjs.Ease.linear);var e=["","PROGRAMMING / GAME DESIGN:","Konstantin Boronenkov","","ART:","Vladimir Makarov","Anna Turkova","","MUSIC:","Alexander Ahura","","Hypnocat Studio 2014","gibbetsfeedback@gmail.com","","SPONSORED BY:","KeyGames.com"];for(var d=0;d<e.length;d++){var c=new createjs.Text(e[d],"bold 35px Arial","#222222");c.textAlign="center";this.container.addChild(c);c.x=Constants.ASSETS_WIDTH/2;c.y=100+d*40}}b.prototype.onMouseDown=function(c,d){this.hide()};b.prototype.hide=function(){if(!this.hiddingNow){createjs.Tween.removeTweens(this.shader);createjs.Tween.get(this.shader).to({alpha:0},400,createjs.Ease.linear).call(function(){return StateManager.g_instance.popState()});createjs.Tween.get(this.container).to({alpha:0},400,createjs.Ease.linear);this.hiddingNow=true}};return b})(GameState);var DNButton=(function(a){__extends(b,a);function b(c,d){a.call(this);this.selected=false;this.func=null;this.enabled=true;this.picture=AssetsManager.g_instance.getCenteredImageWithProxy(c);this.addChild(this.picture);this.func=d;this.picWidth=this.picture.getBounds().width*1.15;this.picHeight=this.picture.getBounds().height*1.15}b.prototype.getPicture=function(){return this.picture};b.prototype.setHandler=function(c){this.func=c};b.prototype.select=function(){if(!this.selected){createjs.Tween.removeTweens(this.picture);createjs.Tween.get(this.picture).to({scaleX:1.15,scaleY:1.15},150,createjs.Ease.linear);this.selected=true}};b.prototype.deselect=function(){if(this.selected){createjs.Tween.removeTweens(this.picture);createjs.Tween.get(this.picture).to({scaleX:1,scaleY:1},150,createjs.Ease.linear);this.selected=false}};b.prototype.onMouseDown=function(c,d){if(this.hitTestSmart(c,d)){this.liveTime=0;this.select()}};b.prototype.onMouseUp=function(c,d){if(this.hitTestSmart(c,d)&&this.selected){if(!b.wasHandlerOnThisFrame){b.wasHandlerOnThisFrame=true;this.func();SoundManager.g_instance.play(SoundManager.SOUND_CLICK)}}this.deselect()};b.prototype.onMouseMove=function(c,d){if(!this.hitTestSmart(c,d)){this.deselect()}};b.prototype.hitTestSmart=function(c,g){if(!this.enabled){return}if(!this.parent||!this.visible){return false}var f=this.picture.localToGlobal(0,0);f.x/=Constants.SCREEN_SCALE;f.y/=Constants.SCREEN_SCALE;var d=this.picture.getBounds().width*0.6*this.scaleX;var e=this.picture.getBounds().height*0.6*this.scaleY;return f.x<c+d&&f.x>c-d&&f.y<g+e&&f.y>g-e};b.prototype.setEnabled=function(c){this.enabled=c};b.wasHandlerOnThisFrame=false;return b})(GUIObject);var DNJellyButton=(function(b){__extends(a,b);function a(c,d){b.call(this);this.selected=false;this.func=null;this.enabled=true;this.picture=AssetsManager.g_instance.getCenteredImageWithProxy(c);this.addChild(this.picture);this.func=d;this.picWidth=this.picture.getBounds().width*1.15;this.picHeight=this.picture.getBounds().height*1.15}a.prototype.getPicture=function(){return this.picture};a.prototype.setHandler=function(c){this.func=c};a.prototype.forceUpdate=function(c){b.prototype.forceUpdate.call(this,c);if(this.jellier){this.jellier.update(c);if(this.jellier.isDead()){this.jellier=null}}};a.prototype.select=function(){if(!this.selected){this.jellier=new Jellier(this.picture,15,0);this.selected=true}};a.prototype.deselect=function(){if(this.selected){this.selected=false}};a.prototype.onMouseDown=function(c,d){if(this.hitTestSmart(c,d)){this.liveTime=0;this.select()}};a.prototype.onMouseUp=function(c,d){if(this.hitTestSmart(c,d)&&this.selected){if(!DNButton.wasHandlerOnThisFrame){DNButton.wasHandlerOnThisFrame=true;this.func();SoundManager.g_instance.play(SoundManager.SOUND_CLICK)}}this.deselect()};a.prototype.onMouseMove=function(c,d){if(!this.hitTestSmart(c,d)){this.deselect()}};a.prototype.hitTestSmart=function(c,g){if(!this.enabled){return}if(!this.parent||!this.visible){return false}var f=this.picture.localToGlobal(0,0);f.x/=Constants.SCREEN_SCALE;f.y/=Constants.SCREEN_SCALE;var d=this.picture.getBounds().width*0.6*this.scaleX;var e=this.picture.getBounds().height*0.6*this.scaleY;return f.x<c+d&&f.x>c-d&&f.y<g+e&&f.y>g-e};a.prototype.setEnabled=function(c){this.enabled=c};return a})(GUIObject);var DNTextField=(function(b){__extends(a,b);function a(d,e,c){b.call(this);this.textWidth=0;this.fontNamePrefix="";this.letterDistance=0;if(e){this.fontNamePrefix=e}if(c){this.letterDistance=c}if(d){this.setText(d)}}a.prototype.setText=function(g){if(this.text==g){return}this.text=g;this.removeAllChildren();var c=0;for(var e=0;e<g.length;e++){var d=g.charAt(e);if(d=="-"){continue}var f=AssetsManager.g_instance.getImage(this.fontNamePrefix+d);this.addChild(f);f.x=c;if(f.getBounds()){c+=f.getBounds().width+this.letterDistance}}this.textWidth=c};a.prototype.getWidth=function(){return this.textWidth};a.prototype.getText=function(){return this.text};return a})(GUIObject);var FlyingPoints=(function(b){__extends(a,b);function a(d){b.call(this);this.delay=0.2;this.wasShow=false;var c=new DNTextField("p"+d.toString(),"points_font/",-8);this.addChild(c);c.x=-c.getBounds().width/2;c.y=-c.getBounds().height/2;this.scaleX=this.scaleY=0.1;this.visible=false}a.prototype.update=function(c){this.delay-=c;if(this.delay>0){return}else{if(!this.wasShow){this.wasShow=true;createjs.Tween.get(this).to({scaleX:1,scaleY:1},400,createjs.Ease.backOut);this.visible=true}}b.prototype.update.call(this,c);if(this.liveTime>0.5){this.y-=c*70;this.alpha-=c*1.5;if(this.alpha<=0){this.kill()}}};return a})(GameObject);var ConvertToBonusEffect=(function(a){__extends(b,a);function b(c){a.call(this);this.chip=c;this.scaleX=this.scaleY=2.5}b.prototype.update=function(c){a.prototype.update.call(this,c);this.rotation+=c*Math.PI*35;if(this.scaleX>1){this.scaleX-=c*3;this.scaleY-=c*3}if(this.liveTime>1.2){this.alpha-=c*3;if(this.alpha<=0){this.kill()}}this.x=this.chip.x;this.y=this.chip.y-Constants.CELL_SIZE/2;if(this.chip.isDead()){this.kill()}};return b})(GameObject);var KillLineEffect=(function(a){__extends(b,a);function b(c){a.call(this);this.speed=c;this.addChild(AssetsManager.g_instance.getCenteredImage(Images.SICKLE));if(c.x<0){this.rotation=180;this.dir=-1}if(c.x>0){this.rotation=0;this.dir=+1}if(c.y<0){this.rotation=-90;this.dir=-1}if(c.y>0){this.rotation=+90;this.dir=+1}}b.prototype.update=function(c){a.prototype.update.call(this,c);this.rotation+=c*3*360*this.dir;this.x+=c*this.speed.x;this.y+=c*this.speed.y;if(this.x>Constants.ASSETS_WIDTH+172/2){this.kill()}if(this.x<-172/2){this.kill()}if(this.y<300&&this.speed.y<0){this.alpha-=c*6}if(this.y<-106/2){this.kill()}if(this.y>Constants.SCREEN_HEIGHT+106/2){this.kill()}};return b})(GameObject);var KillColorEffect=(function(b){__extends(a,b);function a(g,f){b.call(this);var e=2000;var c=new createjs.Point(f.x-g.x,f.y-g.y);this.distance=Math.sqrt(c.x*c.x+c.y*c.y);this.maxTime=this.distance/e;var d=c.x/this.distance;this.speed=new createjs.Point(c.x/this.distance*e,c.y/this.distance*e);this.rotation=Utils.RadToGrad(Math.atan2(c.y,c.x))}a.prototype.update=function(c){b.prototype.update.call(this,c);if(this.liveTime<this.maxTime){this.x+=c*this.speed.x;this.y+=c*this.speed.y}else{this.alpha-=c*3.5;if(this.alpha<=0){this.kill()}}};return a})(GameObject);var ShowAwesomeEffect=(function(b){__extends(a,b);function a(c,d){b.call(this,c);this.die=false;if(d){this.scaleX=this.scaleY=d}else{this.scaleX=this.scaleY=1.2}this.y=400;this.x=-250;createjs.Tween.get(this).wait(300).to({x:350},600,createjs.Ease.backOut)}a.prototype.update=function(c){var d=this;b.prototype.update.call(this,c);if(this.liveTime>1.5&&!this.die){this.die=true;createjs.Tween.get(this).to({scaleX:1.8,scaleY:1.8},600,createjs.Ease.backIn);createjs.Tween.get(this).wait(300).to({alpha:0},300,createjs.Ease.linear).call(function(){return d.kill()})}};return a})(Skewer);var Tutorial=(function(a){__extends(b,a);function b(){a.call(this);this.stage=0}b.prototype.onStartRound=function(){this.onMatch()};b.prototype.onMatch=function(){this.stage++};b.prototype.onDead=function(){a.prototype.onDead.call(this)};return b})(GameObject);var PortraitLockState=(function(b){__extends(a,b);function a(){b.call(this);this.scaleX=this.scaleY=1/Constants.SCREEN_SCALE;var c=window.innerWidth*Constants.PIXEL_RATIO;var e=window.innerHeight*Constants.PIXEL_RATIO;var f=new createjs.Shape();f.graphics.beginFill("#4aa4c2");f.graphics.drawRect(0,0,c,e);f.graphics.endFill();this.addChild(f);var g=AssetsManager.g_instance.getCenteredImage(Images.ROTATE);var d=new createjs.Container();this.addChild(d);d.addChild(g);d.x=c/2;d.y=e/2}a.prototype.onOrientationChanged=function(c){if(!c){StateManager.g_instance.popState()}};return a})(GameState);var SelectLevelButton=(function(b){__extends(a,b);function a(e){var k=this;b.call(this,GameData.getInstance().levelsAvailable()>e?Images.BUTTON_LEVEL:Images.BUTTON_LEVEL_LOCKED,function(){return k.onClick()});var d=GameData.getInstance().levelsAvailable()>e;this.setEnabled(d);this.levelNum=e;if(d){var j=new DNTextField((e+1).toString(),"level_font/");this.getPicture().addChild(j);var h=1;j.scaleX=j.scaleY=h;j.x=-j.getBounds().width/2*h;j.y=-j.getBounds().height/2*h;var c=GameData.getInstance().getStarsByLevel(e);if(c>0){for(var f=0;f<3;f++){var g=AssetsManager.g_instance.getCenteredImageWithProxy(f<c?Images.STAR_MINI:Images.STAR_MINI_EMPTY);this.getPicture().addChild(g);g.x=f*45-41;g.y=60}}}}a.prototype.onMouseDown=function(c,d){b.prototype.onMouseDown.call(this,c,d);this.touchX=c};a.prototype.onMouseUp=function(c,d){if(Math.abs(c-this.touchX)>30){this.deselect();return}b.prototype.onMouseUp.call(this,c,d)};a.prototype.onClick=function(){StateManager.g_instance.pushState(new ShadeInState(new PlayState(this.levelNum)))};return a})(DNJellyButton);var SelectLevelState=(function(a){__extends(b,a);function b(){var f=this;a.call(this);this.touchPoint=0;this.pointsControl=new StatusPointsControl(3,0);this.layer=new createjs.Container();this.currentBoxesCount=3;this.tween=null;this.loadLayout(Layouts.SELECT_LEVEL_LAYOUT,this);this.findGUIObject(Layouts.NAME_BUTTON_BACK).setHandler(function(){return f.onBackTouch()});this.addChild(this.layer);this.addChild(this.pointsControl);this.pointsControl.x=Constants.ASSETS_WIDTH/2;this.pointsControl.y=760;var e=3;var h=210;var g=165;for(var m=0;m<e;m++){var d=0;for(var j=0;j<3;j++){for(var k=0;k<3;k++){var c=Constants.ASSETS_WIDTH*m;var l=new SelectLevelButton(m*9+j*3+k);l.x=k*h+c+Constants.ASSETS_WIDTH/2-h;l.y=j*g+300;l.scaleX=l.scaleY=0.85;this.layer.addChild(l);this.addGuiObject(l);d++;var i=new Jellier(l,15,d*0.1);this.addGameObject(i)}}}this.setCurrentScreen();this.alignByCenter()}b.prototype.update=function(c){a.prototype.update.call(this,c);this.alignByCenter()};b.prototype.onBackTouch=function(){StateManager.g_instance.pushState(new ShadeInState(new MainMenuState()))};b.prototype.onMouseDown=function(c,d){if(this.tween){createjs.Tween.removeTweens(this.layer);this.tween=null}a.prototype.onMouseDown.call(this,c,d);this.touchPoint=c;this.liveTime=0};b.prototype.onMouseMove=function(c,f){a.prototype.onMouseMove.call(this,c,f);var e=Constants.ASSETS_WIDTH*0.2;var d=this.touchPoint-c;if(d>e){this.pointsControl.setActiveElement(b.currentBox+1)}else{if(d<-e){this.pointsControl.setActiveElement(b.currentBox-1)}else{this.pointsControl.setActiveElement(b.currentBox)}}if(b.currentBox==0&&d<0){d*=0.5}else{if(b.currentBox==this.currentBoxesCount-1&&d>0){d*=0.5}else{if(d>e){d=+e+(d-e)*0.5}else{if(d<-e){d=-e+(d+e)*0.5}}}}this.layer.x=-d-b.currentBox*Constants.ASSETS_WIDTH};b.prototype.onMouseUp=function(c,d){a.prototype.onMouseUp.call(this,c,d);if(b.currentBox!=this.pointsControl.getActiveElement()){this.setCurrentBox(this.pointsControl.getActiveElement())}this.tween=createjs.Tween.get(this.layer).to({x:-b.currentBox*Constants.ASSETS_WIDTH},800,createjs.Ease.quintOut)};b.prototype.setCurrentBox=function(c){b.currentBox=c};b.prototype.setCurrentScreen=function(){this.pointsControl.setActiveElement(b.currentBox);this.layer.x=-b.currentBox*Constants.ASSETS_WIDTH};b.currentBox=0;return b})(GameState);var AutoreleaseEffect=(function(b){__extends(a,b);function a(d,c,f){b.call(this);this.frames=new Array();this.frame=0;this.frameTime=f;for(var e=0;e<c;e++){this.frames.push(AssetsManager.g_instance.getCenteredImageWithProxy(d+e))}this.update(10)}a.prototype.update=function(c){b.prototype.update.call(this,c);if(this.liveTime>this.frameTime){this.liveTime=0;this.frame++;if(this.frame>=this.frames.length){this.frame=this.frames.length-1;this.kill()}this.removeAllChildren();this.addChild(this.frames[this.frame])}};return a})(GameObject);function init(){var c=[];var e=[{images:["explosion_1"],frames:[[306,306,150,150],[306,154,150,150],[154,306,150,150],[154,154,150,150],[306,2,150,150],[154,2,150,150],[2,306,150,150],[2,154,150,150],[2,2,150,150]],animations:{"explosion_1/0":[0],"explosion_1/1":[1],"explosion_1/2":[2],"explosion_1/3":[3],"explosion_1/4":[4],"explosion_1/5":[5],"explosion_1/6":[6],"explosion_1/7":[7],"explosion_1/8":[8]}},{images:["explosion_2"],frames:[[306,306,150,150],[306,154,150,150],[154,306,150,150],[154,154,150,150],[306,2,150,150],[154,2,150,150],[2,306,150,150],[2,154,150,150],[2,2,150,150]],animations:{"explosion_2/0":[0],"explosion_2/1":[1],"explosion_2/2":[2],"explosion_2/3":[3],"explosion_2/4":[4],"explosion_2/5":[5],"explosion_2/6":[6],"explosion_2/7":[7],"explosion_2/8":[8]}},{images:["explosion_3"],frames:[[306,306,150,150],[306,154,150,150],[154,306,150,150],[154,154,150,150],[306,2,150,150],[154,2,150,150],[2,306,150,150],[2,154,150,150],[2,2,150,150]],animations:{"explosion_3/0":[0],"explosion_3/1":[1],"explosion_3/2":[2],"explosion_3/3":[3],"explosion_3/4":[4],"explosion_3/5":[5],"explosion_3/6":[6],"explosion_3/7":[7],"explosion_3/8":[8]}},{images:["explosion_4"],frames:[[306,306,150,150],[306,154,150,150],[154,306,150,150],[154,154,150,150],[306,2,150,150],[154,2,150,150],[2,306,150,150],[2,154,150,150],[2,2,150,150]],animations:{"explosion_4/0":[0],"explosion_4/1":[1],"explosion_4/2":[2],"explosion_4/3":[3],"explosion_4/4":[4],"explosion_4/5":[5],"explosion_4/6":[6],"explosion_4/7":[7],"explosion_4/8":[8]}},{images:["explosion_5"],frames:[[306,306,150,150],[306,154,150,150],[154,306,150,150],[154,154,150,150],[306,2,150,150],[154,2,150,150],[2,306,150,150],[2,154,150,150],[2,2,150,150]],animations:{"explosion_5/0":[0],"explosion_5/1":[1],"explosion_5/2":[2],"explosion_5/3":[3],"explosion_5/4":[4],"explosion_5/5":[5],"explosion_5/6":[6],"explosion_5/7":[7],"explosion_5/8":[8]}},{images:["explosion_6"],frames:[[306,306,150,150],[306,154,150,150],[154,306,150,150],[154,154,150,150],[306,2,150,150],[154,2,150,150],[2,306,150,150],[2,154,150,150],[2,2,150,150]],animations:{"explosion_6/0":[0],"explosion_6/1":[1],"explosion_6/2":[2],"explosion_6/3":[3],"explosion_6/4":[4],"explosion_6/5":[5],"explosion_6/6":[6],"explosion_6/7":[7],"explosion_6/8":[8]}},{images:["explosion_7"],frames:[[306,306,150,150],[306,154,150,150],[154,306,150,150],[154,154,150,150],[306,2,150,150],[154,2,150,150],[2,306,150,150],[2,154,150,150],[2,2,150,150]],animations:{"explosion_7/0":[0],"explosion_7/1":[1],"explosion_7/2":[2],"explosion_7/3":[3],"explosion_7/4":[4],"explosion_7/5":[5],"explosion_7/6":[6],"explosion_7/7":[7],"explosion_7/8":[8]}},{images:["explosion_evil"],frames:[[306,306,150,150],[306,154,150,150],[154,306,150,150],[154,154,150,150],[306,2,150,150],[154,2,150,150],[2,306,150,150],[2,154,150,150],[2,2,150,150]],animations:{"explosion_evil/0":[0],"explosion_evil/1":[1],"explosion_evil/2":[2],"explosion_evil/3":[3],"explosion_evil/4":[4],"explosion_evil/5":[5],"explosion_evil/6":[6],"explosion_evil/7":[7],"explosion_evil/8":[8]}},{images:["transform"],frames:[[426,638,210,210],[426,426,210,210],[638,214,210,210],[426,214,210,210],[214,638,210,210],[214,426,210,210],[214,214,210,210],[638,2,210,210],[426,2,210,210],[214,2,210,210],[2,638,210,210],[2,426,210,210],[2,214,210,210],[2,2,210,210]],animations:{"transform/0":[0],"transform/1":[1],"transform/10":[2],"transform/11":[3],"transform/12":[4],"transform/13":[5],"transform/2":[6],"transform/3":[7],"transform/4":[8],"transform/5":[9],"transform/6":[10],"transform/7":[11],"transform/8":[12],"transform/9":[13]}},{images:["boom"],frames:[[406,204,200,200],[406,2,200,200],[204,204,200,200],[204,2,200,200],[2,204,200,200],[2,2,200,200]],animations:{"boom/0":[0],"boom/1":[1],"boom/2":[2],"boom/3":[3],"boom/4":[4],"boom/5":[5]}},{images:["jellies"],frames:[[632,422,103,103],[632,317,103,103],[737,107,103,103],[632,212,103,103],[527,422,103,103],[527,317,103,103],[737,2,103,103],[632,107,103,103],[527,212,103,103],[422,422,103,103],[422,317,103,103],[632,2,103,103],[527,107,103,103],[422,212,103,103],[813,367,36,153],[813,212,36,153],[775,367,36,153],[775,212,36,153],[737,367,36,153],[737,212,36,153],[842,2,36,153],[317,422,103,103],[317,317,103,103],[527,2,103,103],[422,107,103,103],[317,212,103,103],[212,422,103,103],[212,317,103,103],[422,2,103,103],[317,107,103,103],[212,212,103,103],[107,422,103,103],[107,317,103,103],[317,2,103,103],[212,107,103,103],[107,212,103,103],[2,422,103,103],[2,317,103,103],[212,2,103,103],[107,107,103,103],[2,212,103,103],[107,2,103,103],[2,107,103,103],[2,2,103,103]],animations:{bomb_1:[0],bomb_1_wake:[1],bomb_2:[2],bomb_2_wake:[3],bomb_3:[4],bomb_3_wake:[5],bomb_4:[6],bomb_4_wake:[7],bomb_5:[8],bomb_5_wake:[9],bomb_6:[10],bomb_6_wake:[11],bomb_7:[12],bomb_7_wake:[13],connection_1:[14],connection_2:[15],connection_3:[16],connection_4:[17],connection_5:[18],connection_6:[19],connection_7:[20],evil_jelly:[21],evil_jelly_dead:[22],jelly_1:[23],jelly_1_happy:[24],jelly_1_wake:[25],jelly_2:[26],jelly_2_happy:[27],jelly_2_wake:[28],jelly_3:[29],jelly_3_happy:[30],jelly_3_wake:[31],jelly_4:[32],jelly_4_happy:[33],jelly_4_wake:[34],jelly_5:[35],jelly_5_happy:[36],jelly_5_wake:[37],jelly_6:[38],jelly_6_happy:[39],jelly_6_wake:[40],jelly_7:[41],jelly_7_happy:[42],jelly_7_wake:[43]}},{images:["points_font"],frames:[[372,2,35,45],[335,2,35,45],[298,2,35,45],[261,2,35,45],[224,2,35,45],[187,2,35,45],[150,2,35,45],[113,2,35,45],[76,2,35,45],[39,2,35,45],[2,2,35,45]],animations:{"points_font/0":[0],"points_font/1":[1],"points_font/2":[2],"points_font/3":[3],"points_font/4":[4],"points_font/5":[5],"points_font/6":[6],"points_font/7":[7],"points_font/8":[8],"points_font/9":[9],"points_font/p":[10]}},{images:["level_font"],frames:[[2,812,56,88],[2,722,56,88],[2,632,56,88],[2,542,56,88],[2,452,56,88],[2,362,56,88],[2,272,56,88],[2,182,56,88],[2,92,56,88],[2,2,56,88]],animations:{"level_font/0":[0],"level_font/1":[1],"level_font/2":[2],"level_font/3":[3],"level_font/4":[4],"level_font/5":[5],"level_font/6":[6],"level_font/7":[7],"level_font/8":[8],"level_font/9":[9]}},{images:["score_font"],frames:[[422,2,33,40],[387,2,33,40],[352,2,33,40],[317,2,33,40],[282,2,33,40],[247,2,33,40],[212,2,33,40],[177,2,33,40],[142,2,33,40],[107,2,33,40],[72,2,33,40],[37,2,33,40],[2,2,33,40]],animations:{"score_font/0":[0],"score_font/1":[1],"score_font/2":[2],"score_font/3":[3],"score_font/4":[4],"score_font/5":[5],"score_font/6":[6],"score_font/7":[7],"score_font/8":[8],"score_font/9":[9],"score_font/d":[11],"score_font/p":[12]}},{images:["all"],frames:[[2,728,362,77],[342,589,108,108],[920,732,37,50],[566,941,68,68],[134,957,97,38],[716,635,150,151],[566,788,150,151],[637,306,180,174],[467,102,180,174],[564,635,150,151],[718,788,86,88],[593,482,150,151],[414,805,150,151],[262,807,150,151],[346,436,150,151],[466,687,96,96],[452,589,96,96],[2,102,463,174],[2,807,258,148],[2,436,342,148],[366,699,98,104],[537,278,98,104],[2,2,700,98],[550,384,85,85],[878,855,70,69],[806,859,70,69],[878,784,70,69],[868,661,70,69],[868,590,70,69],[806,788,70,69],[718,878,70,69],[745,553,70,69],[745,482,70,69],[765,949,60,60],[894,926,65,65],[827,930,65,65],[636,941,65,65],[703,949,60,60],[2,278,533,77],[2,586,338,140],[819,448,141,140],[819,306,141,140],[915,252,42,45],[915,205,42,45],[704,2,241,100],[498,471,93,92],[2,357,492,77],[496,384,50,50],[868,732,50,50],[649,104,288,99],[649,205,264,99],[2,957,130,54]],animations:{awesome:[0],bonus_color:[1],bonus_line:[2],border_corner:[3],border_side:[4],button_credits:[5],button_exit:[6],button_level:[7],button_level_locked:[8],button_more_games:[9],button_pause:[10],button_play:[11],button_restart:[12],button_sound_off:[13],button_sound_on:[14],cell_1:[15],cell_2:[16],cloud_0:[17],cloud_1:[18],cloud_2:[19],dirt_1:[20],dirt_2:[21],gui:[22],highlight:[23],hint_1:[24],hint_2:[25],hint_3:[26],hint_4:[27],hint_bomb:[28],hint_color:[29],hint_hor:[30],hint_rainbow:[31],hint_vert:[32],icon_bomb:[33],icon_color:[34],icon_hor:[35],icon_vert:[36],icon_x:[37],out_of_moves:[38],pause_caption:[39],perfect_star:[40],perfect_star_empty:[41],points_control_big:[42],points_control_small:[43],score_total_score:[44],sickle:[45],splash_time:[46],star_mini:[47],star_mini_empty:[48],task_clear:[49],task_kill:[50],task_match:[51]}}];var b=[Images.FILL,Images.TITLE_MAIN_MENU_BACK,Images.CHOOSE_LEVEL_BACK,Images.BACK];var f=[Images.LOGO,Images.TASK_CLOUD,Images.BACK,Images.TITLE_MAIN_MENU_BACK,Images.TITLE_JELLY,Images.TITLE,Images.CHOOSE_LEVEL_BACK,Images.CHOOSE_LEVEL_CAPTION,Images.MESSAGE_WINDOW,Images.PAUSE_CAPTION,Images.GAMEOVER_CAPTION,Images.LEVEL_COMPLETE_CAPTION,Images.FILL,Images.BUTTON_SCORE];var d=[SoundManager.SOUND_MUSIC,SoundManager.SOUND_CLICK,SoundManager.SOUND_MATCH_1,SoundManager.SOUND_MATCH_2,SoundManager.SOUND_MATCH_3,SoundManager.SOUND_DROP_1,SoundManager.SOUND_DROP_2,SoundManager.SOUND_DROP_3,SoundManager.SOUND_LINE,SoundManager.SOUND_KILL_COLOR,SoundManager.SOUND_BOOM,SoundManager.SOUND_WIN,"select_1","select_2","select_3","select_4","select_5","select_6","select_7","select_8","select_9","select_10",SoundManager.SOUND_CONVERT,SoundManager.SOUND_LOSE,"evil_2","evil_3"];for(var a=0;a<e.length;a++){f.push(e[a]["images"][0])}for(var a=0;a<f.length;a++){if(b.indexOf(f[a])==-1){c.push({src:"assets/art/"+f[a]+".png",id:f[a]})}else{c.push({src:"assets/art/"+f[a]+".jpg",id:f[a]})}}var g=[];createjs.Sound.alternateExtensions=["mp3"];for(var a=0;a<d.length;a++){g.push({src:d[a]+".ogg",id:d[a]})}Constants.g_isPC=!Utils.IsMobileBrowser();new StateManager(c,g,e)}var BonusSplasher=(function(a){__extends(b,a);function b(c){a.call(this);this.bonuses=c;this.liveTime=-0.6}b.prototype.update=function(c){a.prototype.update.call(this,c);if(this.liveTime>=0.35){if(this.bonuses.length==0){this.kill();PlayState.g_instance.endSplashTime()}else{var d=this.bonuses.pop();this.liveTime=0;PlayState.g_instance.matchBonus(d,d.getIndexX(),d.getIndexY(),false);PlayState.g_instance.setState(PlayState.STATE_MATCH)}}};return b})(GameObject);var Cloud=(function(a){__extends(b,a);function b(c){a.call(this);this.container=new createjs.Container();this.speed=Utils.RandomRange(30,50);if(c){this.speed*=0.6;this.alpha=0.5;this.scaleX=this.scaleY=0.6}this.addChild(AssetsManager.g_instance.getCenteredImageWithProxy("cloud_"+Utils.RandomRangeInt(0,2)))}b.prototype.update=function(c){a.prototype.update.call(this,c);this.x+=c*this.speed;if(this.x-this.getBounds().width/2>=Constants.ASSETS_WIDTH){this.x=-this.getBounds().width/2}};return b})(GameObject);var DNPlaceholder=(function(a){__extends(b,a);function b(){a.call(this)}return b})(GUIObject);var DNStaticPicture=(function(b){__extends(a,b);function a(c){b.call(this);this.addChild(AssetsManager.g_instance.getCenteredImage(c))}return a})(GUIObject);var GameData=(function(){function a(){this.STARS_ITEM_NAME="STARS_ITEM_NAME";this.SCORE_ITEM_NAME="SCORE_ITEM_NAME1";this.LEVELS_COMPLETED_NAME="LEVELS_COMPLETED_NAME";this.levelsCompleted=0;this.scorePerLevel=[];this.starsPerLevel=[];this.MATCH_FIRST_LEVEL={form:[[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,1,1,1,1,1,0,0],[0,0,1,1,1,1,1,0,0],[0,0,1,1,1,1,1,0,0],[0,0,1,1,1,1,1,0,0],[0,0,1,1,1,1,1,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0]],dirt:null,chips:[[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,1,2,3,1,1,0,0],[0,0,2,1,3,1,2,0,0],[0,0,1,4,4,2,1,0,0],[0,0,1,1,4,2,3,0,0],[0,0,1,4,1,2,3,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0]],chip_types:4,moves:30,goal_type:PlayState.GOAL_TYPE_MATCH,match_goal_type:PlayState.MATCH_TYPE_JELLY,match_goal_id:3,match_goal_count:15};this.CLEAR_CELL_EDU={form:[[0,0,0,0,0,0,0,0,0],[0,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,0],[0,0,0,0,0,0,0,0,0]],dirt:[[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,1,1,1,1,1,0,0],[0,0,1,1,1,1,1,0,0],[0,0,1,1,1,1,1,0,0],[0,0,1,1,1,1,1,0,0],[0,0,1,1,1,1,1,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0]],chips:[[0,0,0,0,0,0,0,0,0],[0,1,1,2,3,1,2,5,0],[0,1,2,2,1,4,2,5,0],[0,2,1,2,5,1,2,2,0],[0,2,2,3,4,4,3,3,0],[0,1,1,3,1,5,3,4,0],[0,1,4,4,1,5,1,5,0],[0,1,1,3,4,4,4,1,0],[0,0,0,0,0,0,0,0,0]],chip_types:5,moves:30,goal_type:PlayState.GOAL_TYPE_CLEAR_CELLS,match_goal_type:null,match_goal_id:0,match_goal_count:0};this.KILL_BLACK_EDU={form:[[0,0,0,0,0,0,0,0,0],[0,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,0],[0,0,0,0,0,0,0,0,0]],dirt:null,chips:[[0,0,0,0,0,0,0,0,0],[0,1,2,2,3,1,4,5,0],[0,1,3,3,1,4,2,5,0],[0,2,1,4,5,1,2,2,0],[0,2,1,4,4,4,3,3,0],[0,1,3,4,5,4,3,2,0],[0,1,5,9,9,9,1,3,0],[0,1,2,9,9,9,4,3,0],[0,0,0,0,0,0,0,0,0]],chip_types:5,moves:25,goal_type:PlayState.GOAL_TYPE_KILL_BLACK,match_goal_type:null,match_goal_id:0,match_goal_count:0};this.KILL_BLACK_SIMPLE={form:[[0,0,0,0,0,0,0,0,0],[0,1,0,0,0,0,0,1,0],[0,1,0,1,1,1,0,1,0],[0,1,0,1,1,1,0,1,0],[0,1,0,1,1,1,0,1,0],[0,1,0,1,1,1,0,1,0],[0,1,0,1,1,1,0,1,0],[0,1,1,1,1,1,1,1,0],[0,0,0,0,0,0,0,0,0]],dirt:null,chips:[[0,0,0,0,0,0,0,0,0],[0,9,0,2,3,1,0,9,0],[0,9,0,2,1,4,0,9,0],[0,9,0,2,3,1,0,9,0],[0,9,0,3,4,4,0,9,0],[0,9,0,4,2,4,0,9,0],[0,9,0,3,1,1,0,9,0],[0,9,2,3,3,2,2,9,0],[0,0,0,0,0,0,0,0,0]],chip_types:4,moves:35,goal_type:PlayState.GOAL_TYPE_KILL_BLACK,match_goal_type:null,match_goal_id:0,match_goal_count:0};this.CLEAR_CELL_ZUBI_HARD={form:[[0,0,0,0,0,0,0,0,0],[0,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,0],[0,1,0,1,0,1,0,1,0],[0,1,0,1,0,1,0,1,0],[0,0,0,0,0,0,0,0,0]],dirt:[[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,2,0,2,0,2,0,2,0],[0,2,0,2,0,2,0,2,0],[0,2,0,2,0,2,0,2,0],[0,2,0,2,0,2,0,2,0],[0,0,0,0,0,0,0,0,0]],chips:[[0,0,0,0,0,0,0,0,0],[0,4,5,1,2,2,2,1,0],[0,4,5,3,4,5,3,5,0],[0,3,1,2,4,5,3,5,0],[0,3,3,1,3,2,3,5,0],[0,3,3,4,1,1,1,5,0],[0,3,0,2,0,4,0,4,0],[0,3,0,1,0,1,0,1,0],[0,0,0,0,0,0,0,0,0]],chip_types:5,moves:34,goal_type:PlayState.GOAL_TYPE_CLEAR_CELLS,match_goal_type:null,match_goal_id:0,match_goal_count:0};this.KILL_BLACK_PIRAMIDE={form:[[0,0,0,0,0,0,0,0,0],[0,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,0],[0,0,0,0,0,0,0,0,0]],dirt:[[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,2,2,2,2,2,2,2,0],[0,2,2,2,2,2,2,2,0],[0,0,0,0,0,0,0,0,0]],chips:[[0,0,0,0,0,0,0,0,0],[0,1,1,3,4,1,1,5,0],[0,2,5,2,3,5,5,4,0],[0,1,3,3,1,1,4,1,0],[0,1,3,2,9,2,3,4,0],[0,1,2,9,9,9,4,4,0],[0,1,9,9,9,9,9,5,0],[0,9,9,9,9,9,9,9,0],[0,0,0,0,0,0,0,0,0]],chip_types:5,moves:25,goal_type:PlayState.GOAL_TYPE_CLEAR_CELLS,match_goal_type:null,match_goal_id:0,match_goal_count:0};this.CLEAR_CELL_LINES_HARD={form:[[0,0,0,0,0,0,0,0,0],[0,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,0],[0,0,0,0,0,0,0,0,0]],dirt:[[0,0,0,0,0,0,0,0,0],[0,1,1,1,1,1,1,1,0],[0,2,2,2,2,2,2,2,0],[0,1,1,1,1,1,1,1,0],[0,2,2,2,2,2,2,2,0],[0,1,1,1,1,1,1,1,0],[0,2,2,2,2,2,2,2,0],[0,1,1,1,1,1,1,1,0],[0,0,0,0,0,0,0,0,0]],chips:[[0,0,0,0,0,0,0,0,0],[0,1,1,3,4,1,1,6,0],[0,2,2,2,3,5,6,6,0],[0,1,4,3,4,1,4,1,0],[0,1,3,6,6,1,3,4,0],[0,1,2,1,6,5,2,4,0],[0,1,1,4,1,2,1,5,0],[0,1,3,4,5,6,6,5,0],[0,0,0,0,0,0,0,0,0]],chip_types:6,moves:38,goal_type:PlayState.GOAL_TYPE_CLEAR_CELLS,match_goal_type:null,match_goal_id:0,match_goal_count:0};this.CLEAR_CELL_WINDOW_HARD={form:[[0,0,0,0,0,0,0,0,0],[0,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,0],[0,1,1,0,0,0,1,1,0],[0,1,1,0,0,0,1,1,0],[0,1,1,0,0,0,1,1,0],[0,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,0],[0,0,0,0,0,0,0,0,0]],dirt:[[0,0,0,0,0,0,0,0,0],[0,1,1,0,0,0,1,1,0],[0,1,1,0,0,0,1,1,0],[0,1,1,0,0,0,1,1,0],[0,1,1,0,0,0,1,1,0],[0,1,1,0,0,0,1,1,0],[0,1,1,0,0,0,1,1,0],[0,1,1,0,0,0,1,1,0],[0,0,0,0,0,0,0,0,0]],chips:[[0,0,0,0,0,0,0,0,0],[0,5,3,3,2,3,3,3,0],[0,1,5,4,2,3,1,4,0],[0,1,4,0,0,0,5,4,0],[0,4,1,0,0,0,4,1,0],[0,2,2,0,0,0,3,1,0],[0,1,2,1,5,4,1,2,0],[0,1,2,1,5,4,1,2,0],[0,0,0,0,0,0,0,0,0]],chip_types:5,moves:24,goal_type:PlayState.GOAL_TYPE_CLEAR_CELLS,match_goal_type:null,match_goal_id:0,match_goal_count:0};this.CLEAR_CELL_SAND_GLASSES_AVERAGE={form:[[0,0,0,0,0,0,0,0,0],[0,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,0],[0,0,0,1,1,1,0,0,0],[0,0,0,0,1,0,0,0,0],[0,0,0,0,1,0,0,0,0],[0,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,0],[0,0,0,0,0,0,0,0,0]],dirt:[[0,0,0,0,0,0,0,0,0],[0,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,0],[0,0,0,0,0,0,0,0,0]],chips:[[0,0,0,0,0,0,0,0,0],[0,1,1,2,4,4,3,1,0],[0,1,2,1,3,1,2,1,0],[0,0,0,2,4,2,0,0,0],[0,0,0,0,1,0,0,0,0],[0,0,0,0,1,0,0,0,0],[0,1,4,3,4,4,1,2,0],[0,1,4,3,1,1,4,3,0],[0,0,0,0,0,0,0,0,0]],chip_types:4,moves:24,goal_type:PlayState.GOAL_TYPE_CLEAR_CELLS,match_goal_type:null,match_goal_id:0,match_goal_count:0};this.CLEAR_CELL_BRICKET_EASY={form:[[0,0,0,0,0,0,0,0,0],[0,0,1,1,1,1,1,0,0],[0,0,1,1,1,1,1,0,0],[0,0,1,1,1,1,1,0,0],[0,0,1,1,1,1,1,0,0],[0,0,1,1,1,1,1,0,0],[0,0,1,1,1,1,1,0,0],[0,0,1,1,1,1,1,0,0],[0,0,0,0,0,0,0,0,0]],dirt:[[0,0,0,0,0,0,0,0,0],[0,0,1,1,1,1,1,0,0],[0,0,1,1,1,1,1,0,0],[0,0,1,1,1,1,1,0,0],[0,0,1,1,1,1,1,0,0],[0,0,1,1,1,1,1,0,0],[0,0,1,1,1,1,1,0,0],[0,0,1,1,1,1,1,0,0],[0,0,0,0,0,0,0,0,0]],chips:[[0,0,0,0,0,0,0,0,0],[0,0,3,4,4,3,2,0,0],[0,0,1,2,3,1,1,0,0],[0,0,2,1,3,1,2,0,0],[0,0,1,4,4,2,1,0,0],[0,0,1,1,4,2,3,0,0],[0,0,1,4,1,2,3,0,0],[0,0,1,2,4,2,3,0,0],[0,0,0,0,0,0,0,0,0]],chip_types:4,moves:27,goal_type:PlayState.GOAL_TYPE_CLEAR_CELLS,match_goal_type:null,match_goal_id:0,match_goal_count:0};this.MATCH_JUST_RED_EASY={form:[[0,0,0,0,0,0,0,0,0],[0,0,0,1,1,1,0,0,0],[0,0,1,1,1,1,1,0,0],[0,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,0],[0,0,1,1,1,1,1,0,0],[0,0,0,1,1,1,0,0,0],[0,0,0,0,0,0,0,0,0]],dirt:null,chips:[[0,0,0,0,0,0,0,0,0],[0,0,0,4,4,5,0,0,0],[0,0,1,3,3,1,1,0,0],[0,4,5,2,1,5,2,5,0],[0,4,1,5,4,5,1,4,0],[0,5,5,1,4,5,3,3,0],[0,0,1,4,1,5,3,0,0],[0,0,0,4,4,4,0,0,0],[0,0,0,0,0,0,0,0,0]],chip_types:5,moves:35,goal_type:PlayState.GOAL_TYPE_MATCH,match_goal_type:PlayState.MATCH_TYPE_JELLY,match_goal_id:5,match_goal_count:23};this.MATCH_BOMBS_1={form:[[0,0,0,0,0,0,0,0,0],[0,0,0,1,0,1,0,0,0],[0,0,1,1,0,1,1,0,0],[0,1,1,1,0,1,1,1,0],[0,1,1,1,0,1,1,1,0],[0,1,1,1,0,1,1,1,0],[0,0,1,1,0,1,1,0,0],[0,0,0,1,0,1,0,0,0],[0,0,0,0,0,0,0,0,0]],dirt:null,chips:[[0,0,0,0,0,0,0,0,0],[0,0,0,1,0,1,0,0,0],[0,0,1,2,0,1,2,0,0],[0,1,3,4,0,2,3,1,0],[0,4,1,1,0,1,3,2,0],[0,1,4,4,0,3,3,1,0],[0,0,4,1,0,3,1,0,0],[0,0,0,1,0,1,0,0,0],[0,0,0,0,0,0,0,0,0]],chip_types:4,moves:40,goal_type:PlayState.GOAL_TYPE_MATCH,match_goal_type:PlayState.MATCH_TYPE_BOMB,match_goal_id:-1,match_goal_count:7};this.MATCH_LINES_1={form:[[0,0,0,0,0,0,0,0,0],[0,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,0],[0,1,1,1,0,1,1,1,0],[0,1,1,0,0,0,1,1,0],[0,1,1,1,0,1,1,1,0],[0,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,0],[0,0,0,0,0,0,0,0,0]],dirt:null,chips:[[0,0,0,0,0,0,0,0,0],[0,1,4,1,2,1,3,1,0],[0,2,5,5,5,5,4,1,0],[0,1,4,1,0,1,5,4,0],[0,4,4,0,0,0,1,3,0],[0,2,2,1,0,1,1,3,0],[0,1,2,3,5,4,5,3,0],[0,1,4,2,1,3,4,1,0],[0,0,0,0,0,0,0,0,0]],chip_types:5,moves:35,goal_type:PlayState.GOAL_TYPE_MATCH,match_goal_type:PlayState.MATCH_TYPE_HORIZONTAL,match_goal_id:-1,match_goal_count:2};this.CLEAR_CELL_EVIL_WALL_HARD={form:[[0,0,0,0,0,0,0,0,0],[0,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,0],[0,0,0,0,0,0,0,0,0]],dirt:[[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,2,2,2,2,2,2,2,0],[0,2,2,2,2,2,2,2,0],[0,0,0,0,0,0,0,0,0]],chips:[[0,0,0,0,0,0,0,0,0],[0,1,6,1,5,4,1,1,0],[0,6,5,5,5,1,4,4,0],[0,6,1,1,2,3,3,2,0],[0,9,9,9,9,9,9,9,0],[0,9,9,9,9,9,9,9,0],[0,1,2,1,3,1,3,5,0],[0,1,2,1,3,1,4,6,0],[0,0,0,0,0,0,0,0,0]],chip_types:6,moves:25,goal_type:PlayState.GOAL_TYPE_CLEAR_CELLS,match_goal_type:null,match_goal_id:0,match_goal_count:0};this.KILL_BLACK_WITH_VERTICAL_FUN={form:[[0,0,0,0,0,0,0,0,0],[0,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,0],[0,0,0,0,0,0,0,0,0],[0,1,0,1,0,1,0,1,0],[0,1,0,1,0,1,0,1,0],[0,1,0,1,0,1,0,1,0],[0,0,0,0,0,0,0,0,0]],dirt:null,chips:[[0,0,0,0,0,0,0,0,0],[0,1,2,2,3,3,2,3,0],[0,2,2,1,3,2,1,3,0],[0,1,3,1,1,3,2,1,0],[0,0,0,0,0,0,0,0,0],[0,9,0,9,0,9,0,9,0],[0,9,0,9,0,9,0,9,0],[0,9,0,9,0,9,0,9,0],[0,0,0,0,0,0,0,0,0]],chip_types:3,moves:25,goal_type:PlayState.GOAL_TYPE_KILL_BLACK,match_goal_type:null,match_goal_id:3,match_goal_count:10};this.KILL_BLACK_WELL={form:[[0,0,0,0,0,0,0,0,0],[0,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,0],[0,1,1,0,1,0,1,1,0],[0,1,1,0,1,0,1,1,0],[0,1,1,0,1,0,1,1,0],[0,1,1,0,1,0,1,1,0],[0,0,0,0,0,0,0,0,0]],dirt:null,chips:[[0,0,0,0,0,0,0,0,0],[0,1,3,2,1,4,1,1,0],[0,1,3,1,3,1,4,4,0],[0,4,2,1,1,3,1,1,0],[0,4,1,0,9,0,3,3,0],[0,4,4,0,9,0,1,2,0],[0,2,2,0,9,0,2,1,0],[0,1,1,0,9,0,1,1,0],[0,0,0,0,0,0,0,0,0]],chip_types:4,moves:25,goal_type:PlayState.GOAL_TYPE_KILL_BLACK,match_goal_type:null,match_goal_id:3,match_goal_count:10};this.KILL_BLACK_SPACE_INVAIDERS={form:[[0,0,0,0,0,0,0,0,0],[0,1,1,0,0,0,1,1,0],[0,0,1,1,1,1,1,0,0],[0,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,0],[0,1,0,1,1,1,0,1,0],[0,1,0,1,1,1,0,1,0],[0,0,0,0,0,0,0,0,0]],dirt:null,chips:[[0,0,0,0,0,0,0,0,0],[0,9,1,0,0,0,1,9,0],[0,0,3,3,4,2,2,0,0],[0,1,4,2,4,1,2,3,0],[0,2,4,2,4,1,3,3,0],[0,3,4,1,3,3,3,2,0],[0,9,0,1,1,4,0,9,0],[0,9,0,1,1,3,0,9,0],[0,0,0,0,0,0,0,0,0]],chip_types:4,moves:25,goal_type:PlayState.GOAL_TYPE_KILL_BLACK,match_goal_type:null,match_goal_id:3,match_goal_count:10};this.MATCH_COLOR_MANY_FUN={form:[[0,0,0,0,0,0,0,0,0],[0,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,0],[0,0,0,0,0,0,0,0,0]],dirt:null,chips:[[0,0,0,0,0,0,0,0,0],[0,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,0],[0,2,2,2,2,2,2,2,0],[0,3,3,3,3,3,3,3,0],[0,3,3,3,3,3,3,3,0],[0,3,3,3,3,3,3,3,0],[0,0,0,0,0,0,0,0,0]],chip_types:4,moves:35,goal_type:PlayState.GOAL_TYPE_MATCH,match_goal_type:PlayState.MATCH_TYPE_COLOR,match_goal_id:0,match_goal_count:10};this.MATCH_COLOR_1_CHESS={form:[[0,0,0,0,0,0,0,0,0],[0,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,0],[0,0,0,0,0,0,0,0,0]],dirt:null,chips:[[0,0,0,0,0,0,0,0,0],[0,1,3,2,1,5,6,6,0],[0,1,3,3,2,3,2,6,0],[0,9,2,9,1,9,1,9,0],[0,5,9,6,9,2,9,2,0],[0,9,5,9,4,9,3,9,0],[0,2,9,4,9,6,9,2,0],[0,9,3,9,5,9,1,9,0],[0,0,0,0,0,0,0,0,0]],chip_types:6,moves:22,goal_type:PlayState.GOAL_TYPE_MATCH,match_goal_type:PlayState.MATCH_TYPE_COLOR,match_goal_id:-1,match_goal_count:1};this.KILL_BLACK_ANYA_CLONE={form:[[0,0,0,0,0,0,0,0,0],[0,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,0],[0,0,0,0,1,0,0,0,0],[0,0,0,0,1,0,0,0,0],[0,0,0,0,1,0,0,0,0],[0,0,0,0,1,0,0,0,0],[0,0,0,0,0,0,0,0,0]],dirt:null,chips:[[0,0,0,0,0,0,0,0,0],[0,1,4,3,2,2,3,1,0],[0,2,1,4,4,3,3,2,0],[0,2,2,4,1,3,1,4,0],[0,0,0,0,9,0,0,0,0],[0,0,0,0,9,0,0,0,0],[0,0,0,0,9,0,0,0,0],[0,0,0,0,9,0,0,0,0],[0,0,0,0,0,0,0,0,0]],chip_types:4,moves:25,goal_type:PlayState.GOAL_TYPE_KILL_BLACK,match_goal_type:null,match_goal_id:0,match_goal_count:0};this.MATCH_GREEN_WITH_EVIL={form:[[0,0,0,0,0,0,0,0,0],[0,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,0],[0,0,1,1,1,1,1,0,0],[0,0,1,1,0,1,1,0,0],[0,1,0,1,0,1,0,1,0],[0,0,1,1,1,1,1,0,0],[0,0,0,1,1,1,0,0,0],[0,0,0,0,0,0,0,0,0]],dirt:[[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0]],chips:[[0,0,0,0,0,0,0,0,0],[0,7,3,3,3,3,4,5,0],[0,9,9,9,9,9,9,9,0],[0,0,4,3,6,5,6,0,0],[0,0,1,9,0,9,1,0,0],[0,4,0,4,0,4,0,4,0],[0,0,4,2,5,4,4,0,0],[0,0,0,3,4,3,0,0,0],[0,0,0,0,0,0,0,0,0]],chip_types:4,moves:25,goal_type:PlayState.GOAL_TYPE_MATCH,match_goal_type:PlayState.MATCH_TYPE_JELLY,match_goal_id:2,match_goal_count:25};this.CLEAR_CELL_TWO_ISLANDS={form:[[0,0,0,0,0,0,0,0,0],[0,1,1,1,0,1,1,1,0],[0,1,1,1,0,1,1,1,0],[0,1,1,1,0,1,1,1,0],[0,0,0,0,0,0,0,0,0],[0,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,0],[0,0,0,0,0,0,0,0,0]],dirt:[[0,0,0,0,0,0,0,0,0],[0,1,2,1,0,1,2,1,0],[0,1,2,1,0,1,2,1,0],[0,1,2,1,0,1,2,1,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0]],chips:[[0,0,0,0,0,0,0,0,0],[0,2,4,1,0,2,1,3,0],[0,1,3,1,0,3,4,2,0],[0,4,2,4,0,4,2,1,0],[0,0,0,0,0,0,0,0,0],[0,2,1,1,2,4,3,3,0],[0,1,2,3,1,2,4,2,0],[0,2,3,3,1,1,2,4,0],[0,0,0,0,0,0,0,0,0]],chip_types:4,moves:25,goal_type:PlayState.GOAL_TYPE_CLEAR_CELLS,match_goal_type:null,match_goal_id:0,match_goal_count:0};this.KILL_BLACK_CORNERS={form:[[0,0,0,0,0,0,0,0,0],[0,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,0],[0,1,0,1,1,1,0,1,0],[0,1,1,1,0,1,1,1,0],[0,1,0,1,1,1,0,1,0],[0,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,0],[0,0,0,0,0,0,0,0,0]],dirt:[[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0]],chips:[[0,0,0,0,0,0,0,0,0],[0,9,9,6,1,1,9,9,0],[0,9,9,7,6,2,9,9,0],[0,3,0,3,7,5,0,6,0],[0,2,4,1,0,3,6,6,0],[0,1,0,6,7,4,0,4,0],[0,9,9,2,2,4,9,9,0],[0,9,9,3,7,7,9,9,0],[0,0,0,0,0,0,0,0,0]],chip_types:5,moves:25,goal_type:PlayState.GOAL_TYPE_KILL_BLACK,match_goal_type:null,match_goal_id:0,match_goal_count:0};this.MATCH_YELLOW_WITH_EVIL={form:[[0,0,0,0,0,0,0,0,0],[0,1,0,1,0,1,0,1,0],[0,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,0],[0,1,0,1,0,1,0,1,0],[0,0,0,0,0,0,0,0,0]],dirt:null,chips:[[0,0,0,0,0,0,0,0,0],[0,9,0,9,0,9,0,9,0],[0,1,1,3,2,4,3,1,0],[0,1,2,4,3,2,1,3,0],[0,9,9,9,9,9,9,9,0],[0,3,2,3,1,3,3,2,0],[0,1,4,3,4,3,2,1,0],[0,9,0,9,0,9,0,9,0],[0,0,0,0,0,0,0,0,0]],chip_types:4,moves:25,goal_type:PlayState.GOAL_TYPE_MATCH,match_goal_type:PlayState.MATCH_TYPE_JELLY,match_goal_id:3,match_goal_count:40};this.CLEAR_CELL_VOVA_FUN={form:[[0,0,0,0,0,0,0,0,0],[0,1,0,1,1,1,0,1,0],[0,1,0,1,1,1,0,1,0],[0,1,0,1,1,1,0,1,0],[0,1,0,1,1,1,0,1,0],[0,1,0,1,1,1,0,1,0],[0,1,0,1,1,1,0,1,0],[0,1,0,1,1,1,0,1,0],[0,0,0,0,0,0,0,0,0]],dirt:[[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,1,0,0,0,0,0,1,0],[0,1,0,0,0,0,0,1,0],[0,1,0,0,0,0,0,1,0],[0,1,0,0,0,0,0,1,0],[0,1,0,0,0,0,0,1,0],[0,0,0,0,0,0,0,0,0]],chips:[[0,0,0,0,0,0,0,0,0],[0,6,0,6,4,1,0,4,0],[0,6,0,7,4,2,0,4,0],[0,9,0,3,7,5,0,9,0],[0,6,0,4,4,3,0,4,0],[0,9,0,4,7,3,0,9,0],[0,6,2,2,1,3,0,4,0],[0,6,2,2,1,1,0,4,0],[0,0,0,0,0,0,0,0,0]],chip_types:4,moves:25,goal_type:PlayState.GOAL_TYPE_CLEAR_CELLS,match_goal_type:null,match_goal_id:0,match_goal_count:0};this.CLEAR_CELL_ISLAND={form:[[0,0,0,0,0,0,0,0,0],[0,1,1,1,1,1,1,1,0],[0,1,1,1,0,1,1,1,0],[0,1,1,0,0,0,1,1,0],[0,1,0,0,1,0,0,1,0],[0,1,1,0,0,0,1,1,0],[0,1,1,1,0,1,1,1,0],[0,1,1,1,1,1,1,1,0],[0,0,0,0,0,0,0,0,0]],dirt:[[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,1,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0]],chips:[[0,0,0,0,0,0,0,0,0],[0,3,4,1,4,1,2,2,0],[0,1,4,1,0,4,2,1,0],[0,2,1,0,0,0,1,3,0],[0,2,0,0,1,0,0,3,0],[0,4,2,0,0,0,3,1,0],[0,1,4,2,0,1,2,2,0],[0,3,4,2,1,3,1,1,0],[0,0,0,0,0,0,0,0,0]],chip_types:4,moves:25,goal_type:PlayState.GOAL_TYPE_CLEAR_CELLS,match_goal_type:null,match_goal_id:3,match_goal_count:40};this.MATCH_RAINBOW={form:[[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0]],dirt:null,chips:[[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,1,1,4,1,3,3,1,0],[0,2,1,3,1,5,5,5,0],[0,2,1,3,4,5,1,5,0],[0,3,3,2,1,3,4,5,0],[0,2,3,1,2,1,2,1,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0]],chip_types:5,moves:27,goal_type:PlayState.GOAL_TYPE_MATCH,match_goal_type:PlayState.MATCH_TYPE_JELLY,match_goal_id:7,match_goal_count:15};this.levels=[this.MATCH_FIRST_LEVEL,this.MATCH_JUST_RED_EASY,this.CLEAR_CELL_EDU,this.CLEAR_CELL_BRICKET_EASY,this.KILL_BLACK_EDU,this.KILL_BLACK_SIMPLE,this.MATCH_RAINBOW,this.KILL_BLACK_PIRAMIDE,this.CLEAR_CELL_SAND_GLASSES_AVERAGE,this.CLEAR_CELL_ISLAND,this.MATCH_LINES_1,this.KILL_BLACK_WELL,this.KILL_BLACK_SPACE_INVAIDERS,this.MATCH_BOMBS_1,this.MATCH_COLOR_MANY_FUN,this.KILL_BLACK_WITH_VERTICAL_FUN,this.CLEAR_CELL_VOVA_FUN,this.KILL_BLACK_ANYA_CLONE,this.MATCH_GREEN_WITH_EVIL,this.CLEAR_CELL_TWO_ISLANDS,this.MATCH_COLOR_1_CHESS,this.KILL_BLACK_CORNERS,this.MATCH_YELLOW_WITH_EVIL,this.CLEAR_CELL_LINES_HARD,this.CLEAR_CELL_WINDOW_HARD,this.CLEAR_CELL_ZUBI_HARD,this.CLEAR_CELL_EVIL_WALL_HARD]}a.getInstance=function(){if(this.instance==null){this.instance=new a()}return this.instance};a.prototype.save=function(){try{window.localStorage.setItem(this.LEVELS_COMPLETED_NAME,this.levelsCompleted.toString());window.localStorage.setItem(this.STARS_ITEM_NAME,JSON.stringify(this.starsPerLevel));window.localStorage.setItem(this.SCORE_ITEM_NAME,JSON.stringify(this.scorePerLevel))}catch(b){}};a.prototype.load=function(){try{if(window.localStorage.getItem(this.STARS_ITEM_NAME)){this.starsPerLevel=JSON.parse(window.localStorage.getItem(this.STARS_ITEM_NAME))}if(window.localStorage.getItem(this.SCORE_ITEM_NAME)){this.scorePerLevel=JSON.parse(window.localStorage.getItem(this.SCORE_ITEM_NAME))}if(!this.starsPerLevel||this.starsPerLevel.length<a.getTotalLevels()){for(var b=0;b<a.getTotalLevels();b++){this.starsPerLevel.push(0)}}if(!this.scorePerLevel||this.scorePerLevel.length<a.getTotalLevels()){for(var b=0;b<a.getTotalLevels();b++){this.scorePerLevel.push(0)}}this.levelsCompleted=+window.localStorage.getItem(this.LEVELS_COMPLETED_NAME)||0}catch(c){console.log(c)}};a.prototype.onWinLevel=function(f,d,b){try{this.scorePerLevel[f]=Math.max(d,this.scorePerLevel[f]);this.starsPerLevel[f]=Math.max(b,this.starsPerLevel[f]);if(f>=this.levelsCompleted){this.levelsCompleted=f+1;if(this.levelsCompleted>a.getTotalLevels()){this.levelsCompleted=a.getTotalLevels()}}this.save()}catch(c){}};a.prototype.getTotalScore=function(){var c=0;for(var b=0;b<a.getTotalLevels();b++){c+=this.scorePerLevel[b]}return c};a.prototype.getStarsByLevel=function(b){return this.starsPerLevel[b]};a.prototype.levelsAvailable=function(){return Math.min(this.levelsCompleted+1,a.getTotalLevels())};a.prototype.getLevelDef=function(b){return this.levels[b]};a.getTotalLevels=function(){return 27};a.instance=null;return a})();var Images=(function(){function a(){}a.BUTTON_MORE_GAMES="button_more_games";a.BUTTON_SOUND_ON="button_sound_on";a.BUTTON_SOUND_OFF="button_sound_off";a.BUTTON_PLAY="button_play";a.BUTTON_EXIT="button_exit";a.BUTTON_PAUSE="button_pause";a.BUTTON_RESTART="button_restart";a.BUTTON_CREDITS="button_credits";a.AWESOME="awesome";a.SPLASH_TIME="splash_time";a.BACK="back";a.MESSAGE_WINDOW="message_window";a.PAUSE_CAPTION="pause_caption";a.GAMEOVER_CAPTION="gameover_caption";a.LEVEL_COMPLETE_CAPTION="level_complete_caption";a.TITLE="title";a.TITLE_JELLY="title_jelly";a.TITLE_MAIN_MENU_BACK="main_menu_back";a.SICKLE="sickle";a.ROTATE="rotate";a.POINTS_CONTROL_BIG="points_control_big";a.POINTS_CONTROL_SMALL="points_control_small";a.DIRT_1="dirt_1";a.DIRT_2="dirt_2";a.CHOOSE_LEVEL_BACK="choose_level_back";a.CHOOSE_LEVEL_CAPTION="choose_level_caption";a.BUTTON_LEVEL="button_level";a.BUTTON_LEVEL_LOCKED="button_level_locked";a.EVIL_JELLY="evil_jelly";a.EVIL_JELLY_DEAD="evil_jelly_dead";a.BONUS_LINE="bonus_line";a.BONUS_COLOR="bonus_color";a.HINT_RAINBOW="hint_rainbow";a.HINT_BOMB="hint_bomb";a.HINT_VERT="hint_vert";a.HINT_HOR="hint_hor";a.HINT_COLOR="hint_color";a.CELL_1="cell_1";a.CELL_2="cell_2";a.BORDER_CORNER="border_corner";a.BORDER_SIDE="border_side";a.GUI="gui";a.TASK_CLOUD="task_cloud";a.HIGHLIGHT="highlight";a.PERFECT_STAR="perfect_star";a.PERFECT_STAR_EMPTY="perfect_star_empty";a.STAR_MINI="star_mini";a.STAR_MINI_EMPTY="star_mini_empty";a.SCORE_TOTAL_SCORE="score_total_score";a.FILL="fill";a.OUT_OF_MOVES="out_of_moves";a.ICON_BOMB="icon_bomb";a.ICON_HOR="icon_hor";a.ICON_VERT="icon_vert";a.ICON_COLOR="icon_color";a.ICON_X="icon_x";a.TASK_CLEAR="task_clear";a.TASK_KILL="task_kill";a.TASK_MATCH="task_match";a.LOGO="logo";a.BUTTON_SCORE="button_score";return a})();var Jellier=(function(b){__extends(a,b);function a(e,d,c){b.call(this);this.jellyScale=0.1;this.origScale=e.scaleX;this.speed=d;this.obj=e;this.delay=c}a.prototype.update=function(d){if(this.delay>0){this.delay-=d;return}b.prototype.update.call(this,d);var c=this.liveTime*this.speed;this.jellyScale=0.2*(Math.PI*3-c)/(Math.PI*3);var e=Math.sin(c)*this.jellyScale;this.obj.scaleX=this.origScale+e;this.obj.scaleY=this.origScale-e;if(c>=Math.PI*3){this.obj.scaleX=this.obj.scaleY=1*this.origScale;this.kill()}};return a})(GameObject);var Layouts=(function(){function a(){}a.TYPE_SKEW="skew";a.TYPE_BUTTON="button";a.TYPE_STATIC_PICTURE="static_picture";a.TYPE_PLACEHOLDER="placeholder";a.TYPE_JELLY_BUTTON="jelly_button";a.TYPE_TEXT_FIELD="textfield";a.NAME_BUTTON_PLAY="play";a.NAME_BUTTON_CREDITS="credits";a.NAME_BUTTON_LOGO="logo";a.NAME_SOUND_PLACE="sound";a.NAME_BUTTON_BACK="back";a.NAME_BUTTON_CLOSE="close";a.NAME_BUTTON_EXIT="exit";a.NAME_BUTTON_RESTART="restart";a.NAME_PANEL="panel";a.NAME_CAPTION="caption";a.NAME_BUTTON_MORE_GAMES="more_games";a.NAME_PAUSE="pause";a.NAME_SCORE="score";a.NAME_MOVES="moves";a.NAME_BUTTON_SCORE="button_score";a.MAIN_MENU_LAYOUT=[{type:a.TYPE_STATIC_PICTURE,picture:Images.TITLE_MAIN_MENU_BACK,x:350,y:450},{type:a.TYPE_SKEW,picture:Images.TITLE,x:350,y:200},{type:a.TYPE_SKEW,picture:Images.TITLE_JELLY,x:346,y:480},{type:a.TYPE_JELLY_BUTTON,name:a.NAME_BUTTON_PLAY,picture:Images.BUTTON_PLAY,x:350,y:710,scale:1.1},{type:a.TYPE_JELLY_BUTTON,name:a.NAME_BUTTON_LOGO,picture:Images.LOGO,x:350,y:820,scale:0.65},{type:a.TYPE_JELLY_BUTTON,name:a.NAME_BUTTON_MORE_GAMES,picture:Images.BUTTON_MORE_GAMES,x:110,y:765,scale:0.9},{type:a.TYPE_PLACEHOLDER,name:a.NAME_SOUND_PLACE,x:590,y:765},{type:a.TYPE_JELLY_BUTTON,name:a.NAME_BUTTON_CREDITS,picture:Images.BUTTON_CREDITS,x:590,y:635,scale:0.8}];a.SELECT_LEVEL_LAYOUT=[{type:a.TYPE_STATIC_PICTURE,picture:Images.CHOOSE_LEVEL_BACK,x:350,y:450},{type:a.TYPE_SKEW,picture:Images.CHOOSE_LEVEL_CAPTION,x:350,y:140},{type:a.TYPE_JELLY_BUTTON,name:a.NAME_BUTTON_BACK,picture:Images.BUTTON_EXIT,x:120,y:770,scale:0.8}];a.PAUSE_WINDOW_LAYOUT=[{type:a.TYPE_STATIC_PICTURE,picture:Images.MESSAGE_WINDOW,x:350,y:450,name:a.NAME_PANEL,children:[{type:a.TYPE_JELLY_BUTTON,name:a.NAME_BUTTON_PLAY,picture:Images.BUTTON_PLAY,x:0,y:-40},{type:a.TYPE_JELLY_BUTTON,name:a.NAME_BUTTON_EXIT,picture:Images.BUTTON_EXIT,x:-145,y:120,scale:0.75},{type:a.TYPE_JELLY_BUTTON,name:a.NAME_BUTTON_RESTART,picture:Images.BUTTON_RESTART,x:0,y:120,scale:0.75},{type:a.TYPE_PLACEHOLDER,name:a.NAME_SOUND_PLACE,x:145,y:120},{type:a.TYPE_SKEW,name:a.NAME_CAPTION,picture:Images.PAUSE_CAPTION,x:0,y:-220},{type:a.TYPE_JELLY_BUTTON,name:a.NAME_BUTTON_LOGO,picture:Images.LOGO,x:0,y:320,scale:0.65}]}];a.LOSE_WINDOW_LAYOUT=[{type:a.TYPE_STATIC_PICTURE,picture:Images.MESSAGE_WINDOW,x:350,y:450,name:a.NAME_PANEL,children:[{type:a.TYPE_JELLY_BUTTON,name:a.NAME_BUTTON_EXIT,picture:Images.BUTTON_EXIT,x:-145,y:100,scale:0.75},{type:a.TYPE_JELLY_BUTTON,name:a.NAME_BUTTON_MORE_GAMES,picture:Images.BUTTON_MORE_GAMES,x:0,y:100,scale:0.75},{type:a.TYPE_JELLY_BUTTON,name:a.NAME_BUTTON_RESTART,picture:Images.BUTTON_RESTART,x:145,y:100,scale:0.75},{type:a.TYPE_SKEW,name:a.NAME_CAPTION,picture:Images.GAMEOVER_CAPTION,x:0,y:-220},{type:a.TYPE_JELLY_BUTTON,name:a.NAME_BUTTON_LOGO,picture:Images.LOGO,x:0,y:320,scale:0.65}]}];a.WIN_WINDOW_LAYOUT=[{type:a.TYPE_STATIC_PICTURE,picture:Images.MESSAGE_WINDOW,x:350,y:450,name:a.NAME_PANEL,children:[{type:a.TYPE_JELLY_BUTTON,name:a.NAME_BUTTON_PLAY,picture:Images.BUTTON_PLAY,x:+145,y:125,scale:0.75},{type:a.TYPE_JELLY_BUTTON,name:a.NAME_BUTTON_MORE_GAMES,picture:Images.BUTTON_MORE_GAMES,x:0,y:125,scale:0.75},{type:a.TYPE_JELLY_BUTTON,name:a.NAME_BUTTON_EXIT,picture:Images.BUTTON_EXIT,x:-145,y:125,scale:0.75},{type:a.TYPE_STATIC_PICTURE,picture:Images.SCORE_TOTAL_SCORE,x:-100,y:-10},{type:a.TYPE_TEXT_FIELD,font:"score_font/",letter_dist:-7,text:"000000",x:30,y:1,name:"total_score"},{type:a.TYPE_TEXT_FIELD,font:"score_font/",letter_dist:-7,text:"000000",x:30,y:-60,name:"current_score"},{type:a.TYPE_SKEW,name:a.NAME_CAPTION,picture:Images.LEVEL_COMPLETE_CAPTION,x:0,y:-220},{type:a.TYPE_SKEW,name:"perfect_1",picture:Images.PERFECT_STAR,x:-100,y:-145},{type:a.TYPE_SKEW,name:"perfect_1_empty",picture:Images.PERFECT_STAR_EMPTY,x:-100,y:-145},{type:a.TYPE_SKEW,name:"perfect_2",picture:Images.PERFECT_STAR,x:0,y:-145},{type:a.TYPE_SKEW,name:"perfect_2_empty",picture:Images.PERFECT_STAR_EMPTY,x:0,y:-145},{type:a.TYPE_SKEW,name:"perfect_3",picture:Images.PERFECT_STAR,x:+100,y:-145},{type:a.TYPE_SKEW,name:"perfect_3_empty",picture:Images.PERFECT_STAR_EMPTY,x:+100,y:-145},{type:a.TYPE_JELLY_BUTTON,name:a.NAME_BUTTON_LOGO,picture:Images.LOGO,x:0,y:320,scale:0.65}]}];a.PLAYSTATE_WINDOW=[{type:a.TYPE_STATIC_PICTURE,picture:Images.GUI,x:350,y:105,name:a.NAME_PANEL,children:[{type:a.TYPE_JELLY_BUTTON,picture:Images.BUTTON_PAUSE,x:287,y:3,name:a.NAME_PAUSE},{type:a.TYPE_TEXT_FIELD,font:"score_font/",letter_dist:-7,text:"000000",x:-208,y:-43,name:a.NAME_SCORE},{type:a.TYPE_TEXT_FIELD,font:"score_font/",letter_dist:-7,text:"100",x:-208,y:0,name:a.NAME_MOVES}]}];return a})();var LevelDef=(function(){function a(){}return a})();var LoseState=(function(b){__extends(a,b);function a(){var d=this;b.call(this);this.panel=new createjs.Container();this.hiddingNow=false;try{keyGamesAPI_gameOver()}catch(c){}this.shader=new createjs.Shape();this.shader.graphics.beginFill("#000000");this.shader.graphics.drawRect(0,0,Constants.ASSETS_WIDTH,Constants.SCREEN_HEIGHT);this.shader.graphics.endFill();this.addChild(this.shader);this.shader.alpha=0;createjs.Tween.get(this.shader).wait(300).to({alpha:0.4},800,createjs.Ease.linear);this.loadLayout(Layouts.LOSE_WINDOW_LAYOUT,this);this.findGUIObject(Layouts.NAME_BUTTON_EXIT).setHandler(function(){return d.onExitTouch()});this.findGUIObject(Layouts.NAME_BUTTON_RESTART).setHandler(function(){return d.onRestartTouch()});this.findGUIObject(Layouts.NAME_BUTTON_MORE_GAMES).setHandler(function(){return d.onMoreGamesTouch()});this.findGUIObject(Layouts.NAME_BUTTON_LOGO).setHandler(function(){return Utils.goLogo()});this.panel=this.findGUIObject(Layouts.NAME_PANEL);this.panel.alpha=0;createjs.Tween.get(this.panel).to({alpha:1},300,createjs.Ease.linear);this.addGameObject(new Jellier(this.panel,16,0))}a.prototype.hide=function(){if(!this.hiddingNow){createjs.Tween.removeTweens(this.shader);createjs.Tween.get(this.shader).to({alpha:0},400,createjs.Ease.linear).call(function(){return StateManager.g_instance.popState()});createjs.Tween.get(this.panel).to({scaleX:1.3,scaleY:1.3},300,createjs.Ease.backIn);createjs.Tween.get(this.panel).to({alpha:0},300,createjs.Ease.linear);this.hiddingNow=true}};a.prototype.update=function(c){b.prototype.update.call(this,c)};a.prototype.onRestartTouch=function(){StateManager.g_instance.pushState(new ShadeInState(new PlayState(PlayState.g_levelNum,true)))};a.prototype.onExitTouch=function(){StateManager.g_instance.pushState(new ShadeInState(new SelectLevelState()))};a.prototype.onMoreGamesTouch=function(){Utils.goMoreGames()};return a})(GameState);var PauseState=(function(b){__extends(a,b);function a(){var c=this;b.call(this);this.panel=new createjs.Container();this.hiddingNow=false;this.shader=new createjs.Shape();this.shader.graphics.beginFill("#000000");this.shader.graphics.drawRect(0,0,Constants.ASSETS_WIDTH,Constants.SCREEN_HEIGHT);this.shader.graphics.endFill();this.addChild(this.shader);this.shader.alpha=0;createjs.Tween.get(this.shader).wait(300).to({alpha:0.4},800,createjs.Ease.linear);this.loadLayout(Layouts.PAUSE_WINDOW_LAYOUT,this);this.findGUIObject(Layouts.NAME_BUTTON_PLAY).setHandler(function(){return c.hide()});this.findGUIObject(Layouts.NAME_BUTTON_EXIT).setHandler(function(){return c.onExitTouch()});this.findGUIObject(Layouts.NAME_BUTTON_RESTART).setHandler(function(){return c.onRestartTouch()});this.findGUIObject(Layouts.NAME_BUTTON_LOGO).setHandler(function(){return Utils.goLogo()});this.panel=this.findGUIObject(Layouts.NAME_PANEL);this.panel.alpha=0;createjs.Tween.get(this.panel).to({alpha:1},300,createjs.Ease.linear);this.addGameObject(new Jellier(this.panel,16,0));this.setSoundButton()}a.prototype.setSoundButton=function(){var d=this;if(this.soundButton&&this.soundButton.parent){this.soundButton.parent.removeChild(this.soundButton)}var c=SoundManager.g_instance.isSoundEnabled();this.soundButton=new DNJellyButton(c?Images.BUTTON_SOUND_ON:Images.BUTTON_SOUND_OFF,function(){return d.onSoundTouch()});this.findGUIObject(Layouts.NAME_SOUND_PLACE).addChild(this.soundButton);this.addGuiObject(this.soundButton);this.soundButton.scaleX=this.soundButton.scaleY=0.75};a.prototype.hide=function(){if(!this.hiddingNow){createjs.Tween.removeTweens(this.shader);createjs.Tween.get(this.shader).to({alpha:0},400,createjs.Ease.linear).call(function(){return StateManager.g_instance.popState()});createjs.Tween.get(this.panel).to({scaleX:1.3,scaleY:1.3},300,createjs.Ease.backIn);createjs.Tween.get(this.panel).to({alpha:0},300,createjs.Ease.linear);this.hiddingNow=true}};a.prototype.update=function(c){b.prototype.update.call(this,c)};a.prototype.onRestartTouch=function(){StateManager.g_instance.pushState(new ShadeInState(new PlayState(PlayState.g_levelNum,true)))};a.prototype.onExitTouch=function(){StateManager.g_instance.pushState(new ShadeInState(new SelectLevelState()))};a.prototype.onSoundTouch=function(){SoundManager.g_instance.setSoundEnabled(!SoundManager.g_instance.isSoundEnabled());this.setSoundButton()};return a})(GameState);var PlayState=(function(a){__extends(b,a);function b(t,r){var s=this;a.call(this);this.state=null;this.stateTime=0;this.fieldWidth=9;this.fieldHeight=9;this.selectedLine=new Array();this.score=0;this.tmpScore=0;this.chipTypesCount=5;this.edgesAndFieldLayer=new createjs.Container();this.fieldLayer=new createjs.Container();this.edgesLayer=new createjs.Container();this.connectionsLayer=new createjs.Container();this.dirtLayer=new createjs.Container();this.highlightLayer=new createjs.Container();this.chipsLayer=new createjs.Container();this.splashLayer=new createjs.Container();this.pointsLayer=new createjs.Container();this.jellyHintPlace=new createjs.Container();this.waitLose=false;this.waitLoseTime=0;this.waitWin=false;this.waitWinTime=100;this.stars=1;this.showSplashTimeEffect=null;this.dance=false;this.lastLineColor=-1;this.wasMatch=false;this.lastDropSoundTime=-10;this.lastDropID=-1;b.g_levelNum=t;this.addChild(AssetsManager.g_instance.getImage(Images.BACK));this.createClouds();this.loadLayout(Layouts.PLAYSTATE_WINDOW,this);this.addChild(this.edgesAndFieldLayer);this.edgesAndFieldLayer.addChild(this.edgesLayer);this.edgesAndFieldLayer.addChild(this.fieldLayer);this.addChild(this.dirtLayer);this.addChild(this.highlightLayer);this.addChild(this.connectionsLayer);this.addChild(this.chipsLayer);this.addChild(this.splashLayer);this.addChild(this.jellyHintPlace);this.addChild(this.pointsLayer);b.g_instance=this;this.field=new Array(this.fieldWidth);for(var u=0;u<this.fieldWidth;u++){this.field[u]=new Array(this.fieldHeight)}var w=GameData.getInstance().getLevelDef(t);this.spawnDefinedChips(w.chips);var e=w.form;for(var n=0;n<this.fieldWidth;n++){for(var m=0;m<this.fieldHeight;m++){if(e[m][n]==0){this.field[n][m].convertToHole();var h=38/2;var c=this.getXPosByXIndex(n)-Constants.CELL_SIZE/2;var z=this.getYPosByYIndex(m)-Constants.CELL_SIZE;if((m>0&&e[m-1][n]!=0)&&(n>0&&e[m][n-1]!=0)){var q=AssetsManager.g_instance.getImage(Images.BORDER_CORNER);q.x=c-h;q.y=z-h;this.edgesLayer.addChild(q)}if((m>0&&e[m-1][n]!=0)&&(n<this.fieldWidth-1&&e[m][n+1]!=0)){var f=AssetsManager.g_instance.getImage(Images.BORDER_CORNER);f.x=c+Constants.CELL_SIZE+h;f.y=z-h;f.rotation=+90;this.edgesLayer.addChild(f)}if((m<this.fieldHeight-1&&e[m+1][n]!=0)&&(n>0&&e[m][n-1]!=0)){var j=AssetsManager.g_instance.getImage(Images.BORDER_CORNER);j.x=c-h;j.y=z+Constants.CELL_SIZE+h;j.rotation=-90;this.edgesLayer.addChild(j)}if((m<this.fieldHeight-1&&e[m+1][n]!=0)&&(n<this.fieldWidth-1&&e[m][n+1]!=0)){var p=AssetsManager.g_instance.getImage(Images.BORDER_CORNER);p.x=c+Constants.CELL_SIZE+h;p.y=z+Constants.CELL_SIZE+h;p.rotation=-180;this.edgesLayer.addChild(p)}}else{var d=AssetsManager.g_instance.getImage(((n+m)%2==0)?Images.CELL_1:Images.CELL_2);this.fieldLayer.addChild(d);d.x=this.getXPosByXIndex(n)-Constants.CELL_SIZE/2;d.y=this.getYPosByYIndex(m)-Constants.CELL_SIZE;if(n>0&&e[m][n-1]==0){var g=AssetsManager.g_instance.getImage(Images.BORDER_SIDE);g.rotation=-90;g.x=d.x-h;g.y=d.y+Constants.CELL_SIZE;this.edgesLayer.addChildAt(g,0)}if(n<this.fieldWidth-1&&e[m][n+1]==0){var v=AssetsManager.g_instance.getImage(Images.BORDER_SIDE);v.rotation=-90;v.x=d.x+Constants.CELL_SIZE-h;v.y=d.y+Constants.CELL_SIZE;this.edgesLayer.addChildAt(v,0)}if(m>0&&e[m-1][n]==0){var o=AssetsManager.g_instance.getImage(Images.BORDER_SIDE);o.x=d.x;o.y=d.y-h;this.edgesLayer.addChildAt(o,0)}if(m<this.fieldHeight-1&&e[m+1][n]==0){var l=AssetsManager.g_instance.getImage(Images.BORDER_SIDE);l.x=d.x;l.y=d.y+Constants.CELL_SIZE-h;this.edgesLayer.addChildAt(l,0)}if((m>0&&e[m-1][n]==0)&&(n>0&&e[m][n-1]==0)){var q=AssetsManager.g_instance.getImage(Images.BORDER_CORNER);q.x=d.x-h;q.y=d.y-h;this.edgesLayer.addChild(q)}if((m>0&&e[m-1][n]==0)&&(n<this.fieldWidth-1&&e[m][n+1]==0)){var f=AssetsManager.g_instance.getImage(Images.BORDER_CORNER);f.x=d.x+Constants.CELL_SIZE+h;f.y=d.y-h;f.rotation=+90;this.edgesLayer.addChild(f)}if((m<this.fieldHeight-1&&e[m+1][n]==0)&&(n>0&&e[m][n-1]==0)){var j=AssetsManager.g_instance.getImage(Images.BORDER_CORNER);j.x=d.x-h;j.y=d.y+Constants.CELL_SIZE+h;j.rotation=-90;this.edgesLayer.addChild(j)}if((m<this.fieldHeight-1&&e[m+1][n]==0)&&(n<this.fieldWidth-1&&e[m][n+1]==0)){var p=AssetsManager.g_instance.getImage(Images.BORDER_CORNER);p.x=d.x+Constants.CELL_SIZE+h;p.y=d.y+Constants.CELL_SIZE+h;p.rotation=-180;this.edgesLayer.addChild(p)}}}}this.fieldDirtImages=new Array(this.fieldWidth);this.fieldDirtData=new Array(this.fieldWidth);for(var u=0;u<this.fieldWidth;u++){this.fieldDirtImages[u]=new Array(this.fieldHeight);this.fieldDirtData[u]=new Array(this.fieldHeight)}if(w.dirt){for(var n=0;n<this.fieldWidth;n++){for(var m=0;m<this.fieldHeight;m++){this.fieldDirtData[n][m]=w.dirt[m][n];if(this.fieldDirtData[n][m]!=0){var k=AssetsManager.g_instance.getCenteredImageWithProxy(this.fieldDirtData[n][m]==1?Images.DIRT_1:Images.DIRT_2);k.x=this.getXPosByXIndex(n);k.y=this.getYPosByYIndex(m)-Constants.CELL_SIZE/2+2;this.dirtLayer.addChild(k);this.fieldDirtImages[n][m]=k}}}}this.chipTypesCount=w.chip_types;this.movesLeft=w.moves;this.findGUIObject(Layouts.NAME_PAUSE).setHandler(function(){return s.onPauseClick()});this.scoreLabel=(this.findGUIObject(Layouts.NAME_SCORE));this.movesLabel=(this.findGUIObject(Layouts.NAME_MOVES));this.movesLabel.setText(this.movesLeft.toString());this.initGoal(w);if(!r){this.taskEffect=new TaskEffect(w,this.goalLabel.getText());this.addGuiObject(this.taskEffect);this.addGameObjectAtPos(this.taskEffect,this,350,400)}this.initStartSound();this.alignByCenter();this.edgesAndFieldLayer.cache(0,0,700,900)}b.prototype.win=function(){if(this.waitLose||this.waitWin){return}if(this.movesLeft>=8){this.stars=3}else{if(this.movesLeft>=4){this.stars=2}}SoundManager.g_instance.play(SoundManager.SOUND_WIN,0.7);this.waitWin=true;this.addGameObjectAt(new ShowAwesomeEffect(Images.AWESOME),this);var c=Math.ceil(this.movesLeft/3);if(c>0){this.showSplashTimeEffect=new ShowSplashTimeEffect();this.addGameObjectAt(this.showSplashTimeEffect,this);this.addGameObject(new SplashTimeEffect(c))}else{this.endSplashTime()}};b.prototype.lose=function(){if(this.waitLose||this.waitWin){return}SoundManager.g_instance.play(SoundManager.SOUND_LOSE,0.4);this.addGameObjectAt(new ShowAwesomeEffect(Images.OUT_OF_MOVES,0.9),this);this.waitLose=true};b.prototype.initGoal=function(h){this.goalType=h.goal_type;var c=this.findGUIObject(Layouts.NAME_PANEL);this.goalLabel=new DNTextField("0","score_font/",-7);c.addChild(this.goalLabel);this.goalLabel.x=110;this.goalLabel.y=-19;var e="perfect_star";var g=1;switch(this.goalType){case b.GOAL_TYPE_CLEAR_CELLS:e=Images.DIRT_1;g=0.5;break;case b.GOAL_TYPE_KILL_BLACK:e=Images.EVIL_JELLY;g=0.6;break;case b.GOAL_TYPE_MATCH:switch(h.match_goal_type){case b.MATCH_TYPE_BOMB:e=Images.ICON_BOMB;break;case b.MATCH_TYPE_COLOR:e=Images.ICON_COLOR;break;case b.MATCH_TYPE_VERTICAL:e=Images.ICON_VERT;break;case b.MATCH_TYPE_HORIZONTAL:e=Images.ICON_HOR;break;case b.MATCH_TYPE_JELLY:e="jelly_"+h.match_goal_id;g=0.6;break}this.goalCount=h.match_goal_count;this.goalID=h.match_goal_id;this.goalMatchType=h.match_goal_type;break}var d=AssetsManager.g_instance.getCenteredImageWithProxy(e);c.addChild(d);d.y=-2;d.x=50;d.scaleX=d.scaleY=g;var f=AssetsManager.g_instance.getCenteredImageWithProxy(Images.ICON_X);c.addChild(f);f.y=3;f.x=92;this.updateGoalLabel()};b.prototype.updateGoalLabel=function(){switch(this.goalType){case b.GOAL_TYPE_CLEAR_CELLS:var d=0;for(var c=0;c<this.fieldWidth;c++){for(var e=0;e<this.fieldHeight;e++){if(this.fieldDirtData[c][e]!=0){d++}}}this.goalLabel.setText(d.toString());break;case b.GOAL_TYPE_KILL_BLACK:var d=0;for(var c=0;c<this.fieldWidth;c++){for(var e=0;e<this.fieldHeight;e++){if(this.field[c][e]&&this.field[c][e].isEvil()){d++}}}this.goalLabel.setText(d.toString());break;case b.GOAL_TYPE_MATCH:this.goalLabel.setText(this.goalCount.toString());break}};b.prototype.createClouds=function(){this.addGameObjectAtPos(new Cloud(true),this,Utils.RandomRange(0,700),150);this.addGameObjectAtPos(new Cloud(true),this,Utils.RandomRange(0,700),650);this.addGameObjectAtPos(new Cloud(true),this,Utils.RandomRange(0,700),350);this.addGameObjectAtPos(new Cloud(true),this,Utils.RandomRange(0,700),500);this.addGameObjectAtPos(new Cloud(false),this,Utils.RandomRange(0,700),200);this.addGameObjectAtPos(new Cloud(false),this,Utils.RandomRange(0,700),400);this.addGameObjectAtPos(new Cloud(false),this,Utils.RandomRange(0,700),550);this.addGameObjectAtPos(new Cloud(false),this,Utils.RandomRange(0,700),740)};b.prototype.runDance=function(){this.dance=true;for(var d=0;d<this.fieldWidth;d++){for(var e=0;e<this.fieldHeight;e++){var c=this.field[d][e];if(c&&!c.isHole()){c.goDance();this.addGameObject(new Skewer2(c))}}}};b.prototype.rebuildConnections=function(){this.connectionsLayer.removeAllChildren();this.initLastLineColor();for(var k=0;k<this.selectedLine.length-1;k++){var d=this.selectedLine[k];var c=this.selectedLine[k+1];var e=AssetsManager.g_instance.getCenteredImage("connection_"+d.getColorID());var o=new createjs.Container();o.addChild(e);e.scaleX=0.7;o.x=(d.x+c.x)/2;o.y=(d.y+c.y)/2-Constants.CELL_SIZE/2;var j=d.x-c.x;var h=d.y-c.y;o.rotation=Utils.RadToGrad(Math.atan2(h,j))+90;this.connectionsLayer.addChild(o)}this.setHintIcon();this.highlightLayer.removeAllChildren();if(this.selectedLine.length>=3){var g=false;for(var k=0;k<this.selectedLine.length;k++){if(this.selectedLine[k].isBonus()){g=true;break}}if(!g){return}var l=new Array(this.fieldWidth);for(var k=0;k<this.fieldWidth;k++){l[k]=new Array(this.fieldHeight)}var n=this.selectedLine[this.selectedLine.length-1].getIndexX();var m=this.selectedLine[this.selectedLine.length-1].getIndexY();for(var k=0;k<this.selectedLine.length;k++){if(this.selectedLine[k].isBonus()){switch(this.selectedLine[k].getBonusType()){case Chip.BONUS_BOMB:for(var q=n-1;q<n+2;q++){for(var p=m-1;p<m+2;p++){if(this.isValidCoords(q,p)){l[q][p]=1}}}break;case Chip.BONUS_LINE_HOR:for(var q=0;q<this.fieldWidth;q++){l[q][m]=1}break;case Chip.BONUS_LINE_VERT:for(var p=0;p<this.fieldHeight;p++){l[n][p]=1}break;case Chip.BONUS_COLOR:for(var q=0;q<this.fieldWidth;q++){for(var p=0;p<this.fieldHeight;p++){if(this.field[q][p]&&this.field[q][p].getColorID()==this.lastLineColor){l[q][p]=1}}}break}}}for(var q=0;q<this.fieldWidth;q++){for(var p=0;p<this.fieldHeight;p++){if(l[q][p]==1){if(this.field[q][p]!=null&&!this.field[q][p].isHole()){var f=AssetsManager.g_instance.getCenteredImageWithProxy(Images.HIGHLIGHT);this.highlightLayer.addChild(f);f.x=this.getXPosByXIndex(q);f.y=this.getYPosByYIndex(p)-Constants.CELL_SIZE/2;f.scaleX=f.scaleY=95/85}}}}}};b.prototype.onPauseClick=function(){StateManager.g_instance.pushState(new PauseState())};b.prototype.createChip=function(d,g,e){var f=Utils.RandomRangeInt(1,this.chipTypesCount);var c=new Chip(f,d,g,this.getYPosByYIndex(g),e);c.setIncexes(d,g);this.addGameObjectAtPos(c,this.chipsLayer,this.getXPosByXIndex(d),-Constants.CELL_SIZE);this.field[d][g]=c;return c};b.prototype.createDefinedChip=function(d,g,e,f){var c=new Chip(f,d,g,this.getYPosByYIndex(g),e);c.setIncexes(d,g);this.addGameObjectAtPos(c,this.chipsLayer,this.getXPosByXIndex(d),-Constants.CELL_SIZE);this.field[d][g]=c;return c};b.prototype.getXPosByXIndex=function(c){return c*Constants.CELL_SIZE+Constants.CELL_SIZE/2+Constants.FIELD_OFFSET_X};b.prototype.getYPosByYIndex=function(c){return c*Constants.CELL_SIZE+Constants.CELL_SIZE/2+Constants.FIELD_OFFSET_Y};b.prototype.update=function(c){a.prototype.update.call(this,c);this.alignByCenter();if(this.waitLose){this.waitLoseTime+=c;if(this.waitLoseTime>3.5){StateManager.g_instance.pushState(new LoseState());return}}if(this.waitWin){this.waitWinTime-=c;if(this.waitWinTime<0){StateManager.g_instance.pushState(new WinState(this.stars,this.score));return}}this.stateTime+=c;switch(this.state){case b.STATE_WAIT_SPAWN:if(this.allChipsNormal()){this.setState(b.STATE_WAIT_INPUT)}break;case b.STATE_SHIFT:if(this.allChipsNormal()){this.spawnNewChips()}break;case b.STATE_MATCH:if(this.allChipsNormal()){this.shiftChips()}break}if(this.tmpScore<this.score){this.tmpScore+=17;if(this.tmpScore>this.score){this.tmpScore=this.score}this.scoreLabel.setText(Utils.ScoreString(this.tmpScore))}this.highlightLayer.alpha=0.75+Math.sin(this.liveTime*5)*0.25};b.prototype.allChipsNormal=function(){for(var c=0;c<this.fieldWidth;c++){for(var d=0;d<this.fieldHeight;d++){if(this.field[c][d]!=null&&!this.field[c][d].isNormal()){return false}}}return true};b.prototype.onMouseUp=function(c,g){a.prototype.onMouseUp.call(this,c,g);if(this.state!=b.STATE_SELECT_LINE){return}if(this.selectedLine.length>=3){var f=this.selectedLine[this.selectedLine.length-1];var e=new Array();for(var d=0;d<this.selectedLine.length;d++){this.selectedLine[d].match("",d,d*Constants.MATCH_DELAY);if(this.selectedLine[d].isBonus()){e.push(this.selectedLine[d])}}f.queryConvertToBonus(this.selectedLine.length);if(e.length!=0){f.setBonusesToActivate(e)}this.setState(b.STATE_MATCH)}else{for(var d=0;d<this.selectedLine.length;d++){this.selectedLine[d].deselect()}this.setState(b.STATE_WAIT_INPUT)}this.selectedLine.length=0;this.rebuildConnections()};b.prototype.initLastLineColor=function(){for(var c=0;c<this.selectedLine.length;c++){if(this.selectedLine[c].getColorID()!=7){this.lastLineColor=this.selectedLine[c].getColorID()}}};b.prototype.convertRandomChipToBonus=function(){for(var e=0;e<100;e++){var d=Utils.RandomRangeInt(1,this.fieldWidth-2);var f=Utils.RandomRangeInt(1,this.fieldHeight-2);var c=this.field[d][f];if(c&&!c.isHole()&&!c.isEvil()&&!c.isBonus()){c.convertToBonus(7);break}}this.onCreateBonusDuringSplashTime()};b.prototype.convertRandomChipToRainbow=function(){for(var e=0;e<100;e++){var d=Utils.RandomRangeInt(1,this.fieldWidth-2);var f=Utils.RandomRangeInt(1,this.fieldHeight-2);var c=this.field[d][f];if(c&&!c.isHole()&&!c.isEvil()&&!c.isBonus()){c.convertToBonus(5);break}}};b.prototype.runAllBonuses=function(){var e=[];var d=1;for(var c=0;c<this.fieldWidth;c++){for(var f=this.fieldHeight-1;f>=0;f--){if(this.field[c][f]&&this.field[c][f].isBonus()){e.push(this.field[c][f])}}}this.addGameObject(new BonusSplasher(e));if(this.showSplashTimeEffect){this.showSplashTimeEffect.hide()}};b.prototype.endSplashTime=function(){this.waitWinTime=1.9;this.runDance()};b.prototype.onMouseDown=function(d,h){a.prototype.onMouseDown.call(this,d,h);h-=this.y;if(this.waitLose||this.waitWin){return}if(this.taskEffect&&!this.taskEffect.isDead()){return}if(this.state!=b.STATE_WAIT_INPUT&&this.state!=b.STATE_SELECT_LINE){return}var g=null;if(this.selectedLine.length!=0){g=this.selectedLine[this.selectedLine.length-1]}var e=-1;for(var f=0;f<this.selectedLine.length;f++){if(this.selectedLine[f].getColorID()!=7){e=this.selectedLine[f].getColorID()}}var c=null;if(this.selectedLine.length!=0){c=this.findChipAtPos(g.getIndexX(),g.getIndexY(),d,h,this.lastX,this.lastY,e,Constants.CELL_SIZE/2,false)}else{c=this.findChipAtPosSquareHitZone(d,h)}this.lastX=d;this.lastY=h;if(c&&!c.isHole()&&!c.isEvil()){if(!c.isSelected()){if(this.selectedLine.length==0){c.select();this.selectedLine.push(c);this.setState(b.STATE_SELECT_LINE);this.rebuildConnections()}else{if(Math.abs(c.getIndexX()-this.selectedLine[this.selectedLine.length-1].getIndexX())>1){return}if(Math.abs(c.getIndexY()-this.selectedLine[this.selectedLine.length-1].getIndexY())>1){return}c.select();this.selectedLine.push(c);this.rebuildConnections()}SoundManager.g_instance.play("select_"+Math.min(this.selectedLine.length,10),0.7)}else{if(this.selectedLine.length>=2){if(c==this.selectedLine[this.selectedLine.length-2]){this.selectedLine[this.selectedLine.length-1].deselect();this.selectedLine.pop();this.rebuildConnections();SoundManager.g_instance.play("select_"+Math.min(this.selectedLine.length,10),0.7)}}}}if(this.selectedLine.length!=0){this.jellyHintPlace.scaleX=this.jellyHintPlace.scaleY=0.8;this.jellyHintPlace.x=this.selectedLine[this.selectedLine.length-1].x+42;this.jellyHintPlace.y=this.selectedLine[this.selectedLine.length-1].y-Constants.CELL_SIZE-10}};b.prototype.setHintIcon=function(){this.jellyHintPlace.removeAllChildren();for(var c=0;c<this.selectedLine.length;c++){if(this.selectedLine[c].isBonus()){return}}switch(this.selectedLine.length){case 0:break;case 1:case 2:case 3:case 4:this.jellyHintPlace.addChild(AssetsManager.g_instance.getCenteredImageWithProxy("hint_"+this.selectedLine.length));break;case 5:case 6:this.jellyHintPlace.addChild(AssetsManager.g_instance.getCenteredImageWithProxy(Images.HINT_RAINBOW));break;case 7:case 8:this.jellyHintPlace.addChild(AssetsManager.g_instance.getCenteredImageWithProxy(Images.HINT_BOMB));break;case 9:this.jellyHintPlace.addChild(AssetsManager.g_instance.getCenteredImageWithProxy(Images.HINT_HOR));break;case 10:this.jellyHintPlace.addChild(AssetsManager.g_instance.getCenteredImageWithProxy(Images.HINT_VERT));break;default:this.jellyHintPlace.addChild(AssetsManager.g_instance.getCenteredImageWithProxy(Images.HINT_COLOR));break}};b.prototype.onMouseMove=function(c,d){a.prototype.onMouseMove.call(this,c,d);if(this.state!=b.STATE_WAIT_INPUT&&this.state!=b.STATE_SELECT_LINE){return}this.onMouseDown(c,d)};b.prototype.shiftChips=function(){var f=false;for(var g=0;g<this.fieldWidth;g++){var d=false;for(var j=this.fieldHeight-1;j>=0;j--){var c=this.field[g][j];if(!c){continue}if(c.isHole()){continue}for(var e=this.fieldHeight-1;e>j;e--){if(this.field[g][e]==null){if(!d){c.needPlaySound();d=true}f=true;var h=e;this.field[g][j].shiftDown(h,this.getYPosByYIndex(h));this.field[g][h]=this.field[g][j];this.field[g][j]=null;break}}}}if(f){this.setState(b.STATE_SHIFT)}else{this.spawnNewChips()}};b.prototype.initStartSound=function(){for(var c=0;c<this.fieldWidth;c++){for(var d=this.fieldHeight-1;d>=0;d--){if(this.field[c][d]!=null&&!this.field[c][d].isHole()){this.field[c][d].needPlaySound();break}}}};b.prototype.spawnNewChips=function(){var g=0;for(var d=0;d<this.fieldWidth;d++){var f=-1;var e=false;for(var h=this.fieldHeight-1;h>=0;h--){if(this.field[d][h]==null){if(f==-1){f=h}var c=this.createChip(d,h,(f-h)*0.07);if(!e){e=true;c.needPlaySound()}if(this.dance){c.goDance();this.addGameObject(new Skewer2(c))}}}}this.setState(b.STATE_WAIT_SPAWN)};b.prototype.spawnDefinedChips=function(g){for(var d=0;d<this.fieldWidth;d++){var f=-1;var e=false;for(var h=this.fieldHeight-1;h>=0;h--){if(f==-1){f=h}var c=this.createDefinedChip(d,h,(f-h)*0.07+d*0.13,g[h][d]);if(!e&&g[h][d]!=0){e=true;c.needPlaySound()}}}this.setState(b.STATE_WAIT_SPAWN)};b.prototype.findChipAtPos=function(s,q,m,l,h,g,v,j,o){var k=[];var u=[];var w=[[1,1,1],[1,0,1],[1,1,1]];var i=(Constants.CELL_SIZE/2)*(Constants.CELL_SIZE/2);var d=(Constants.CELL_SIZE/2*0.9)*(Constants.CELL_SIZE/2*0.9);for(var t=0;t<3;t++){for(var f=0;f<3;f++){if(w[t][f]==0){continue}var e=t+s-1;var c=f+q-1;if(this.isValidCoords(e,c)){var p=this.field[e][c];if(p){if(v!=-1&&p.getColorID()!=7){if(p.getColorID()!=v){continue}}var n=j;if(p.isSelected()){n*=0.9}if(Utils.LineIntersectCircle(new createjs.Point(m,l),new createjs.Point(h,g),new createjs.Point(p.x,p.y-Constants.CELL_SIZE/2),n)){if(p.isSelected()){k.push(p)}else{u.push(p)}}}}}}if(u.length==1){return u[0]}if(!o){if(k.length!=0){return k[0]}}return null};b.prototype.findChipAtPosSquareHitZone=function(d,g){for(var e=0;e<this.fieldWidth;e++){for(var f=0;f<this.fieldHeight;f++){var c=this.field[e][f];if(c){if((Math.abs(c.x-d)<Constants.CELL_SIZE/2)&&(Math.abs(c.y-g-Constants.CELL_SIZE/2)<Constants.CELL_SIZE/2)){return c}}}}return null};b.prototype.onCreateBonusDuringSplashTime=function(){this.movesLeft-=3;if(this.movesLeft<=0){this.movesLeft=0}this.movesLabel.setText(this.movesLeft.toString())};b.prototype.setState=function(c){if(this.state==c){return}this.state=c;this.stateTime=0;if(this.state==b.STATE_MATCH){this.wasMatch=true;if(!this.waitWin){this.movesLeft--;if(this.movesLeft<=0){this.movesLeft=0}this.movesLabel.setText(this.movesLeft.toString())}}if(this.state==b.STATE_WAIT_INPUT){if(this.wasMatch){this.checkWin();this.wasMatch=false;if(this.movesLeft<=0){this.lose();return}if(!this.findMoves()){do{this.convertRandomChipToRainbow()}while(!this.findMoves())}}}};b.prototype.checkWin=function(){if(this.goalType==b.GOAL_TYPE_CLEAR_CELLS){for(var c=0;c<this.fieldWidth;c++){for(var d=0;d<this.fieldHeight;d++){if(this.fieldDirtData[c][d]!=0){return}}}this.win()}if(this.goalType==b.GOAL_TYPE_KILL_BLACK){for(var c=0;c<this.fieldWidth;c++){for(var d=0;d<this.fieldHeight;d++){if(this.field[c][d]&&this.field[c][d].isEvil()){return}}}this.win()}if(this.goalType==b.GOAL_TYPE_MATCH){if(this.goalCount==0){this.win()}}};b.prototype.onMatchSomething=function(c){if(this.goalType==b.GOAL_TYPE_MATCH){switch(this.goalMatchType){case b.MATCH_TYPE_BOMB:if(c.getBonusType()==Chip.BONUS_BOMB){this.goalCount--}break;case b.MATCH_TYPE_COLOR:if(c.getBonusType()==Chip.BONUS_COLOR){this.goalCount--}break;case b.MATCH_TYPE_HORIZONTAL:if(c.getBonusType()==Chip.BONUS_LINE_HOR){this.goalCount--}break;case b.MATCH_TYPE_VERTICAL:if(c.getBonusType()==Chip.BONUS_LINE_VERT){this.goalCount--}break;case b.MATCH_TYPE_JELLY:if(c.getColorID()==this.goalID){this.goalCount--}break}if(this.goalCount<0){this.goalCount=0}this.updateGoalLabel()}};b.prototype.clearCell=function(d){var c=d.getIndexX();var f=d.getIndexY();this.tryClearDirt(c,f);if(this.field[c][f]==d){this.field[c][f]=null}if(d.getColorID()!=-1){this.addGameObjectAtPos(new AutoreleaseEffect("explosion_"+d.getColorID()+"/",9,0.045),this.splashLayer,d.x,d.y-Constants.CELL_SIZE/2)}else{if(d.isEvil()){var e=new AutoreleaseEffect("explosion_evil/",9,0.055);this.addGameObjectAtPos(e,this,d.x,d.y-Constants.CELL_SIZE/2)}}b.g_instance.updateGoalLabel()};b.prototype.tryClearDirt=function(d,g){if(this.fieldDirtData[d][g]>0){var e=0;var f=this.fieldDirtImages[d][g];if(f){createjs.Tween.get(f).to({alpha:0},300,createjs.Ease.linear).call(function(){return f.parent.removeChild(f)});this.fieldDirtImages[d][g]=null;e=f.parent.getChildIndex(f)}this.fieldDirtData[d][g]--;if(this.fieldDirtData[d][g]==1){var c=AssetsManager.g_instance.getCenteredImageWithProxy(Images.DIRT_1);c.x=this.getXPosByXIndex(d);c.y=this.getYPosByYIndex(g)-Constants.CELL_SIZE/2+2;this.dirtLayer.addChildAt(c,e);this.fieldDirtImages[d][g]=c}this.updateGoalLabel()}if(this.field[d][g]&&!this.field[d][g].isEvil()){if(this.isValidCoords(d+1,g)&&this.field[d+1][g]&&this.field[d+1][g].isEvil()){this.field[d+1][g].match("",10,0)}if(this.isValidCoords(d-1,g)&&this.field[d-1][g]&&this.field[d-1][g].isEvil()){this.field[d-1][g].match("",10,0)}if(this.isValidCoords(d,g+1)&&this.field[d][g+1]&&this.field[d][g+1].isEvil()){this.field[d][g+1].match("",10,0)}if(this.isValidCoords(d,g-1)&&this.field[d][g-1]&&this.field[d][g-1].isEvil()){this.field[d][g-1].match("",10,0)}}};b.prototype.findMoves=function(){for(var c=1;c<this.fieldWidth-2;c++){for(var e=1;e<this.fieldHeight-2;e++){var d=[];if(this.findChain(c,e,-1,d)){return true}}}return false};b.prototype.findChain=function(c,j,d,g){if(!this.isValidCoords(c,j)){return false}if(this.field[c][j]==null){return false}var f=this.field[c][j];if(f.isHole()){return false}if(f.isEvil()){return false}if(g.indexOf(f)!=-1){return false}if(d==-1){d=f.getColorID()}else{if(d!=f.getColorID()&&f.getColorID()!=7){return false}}if(g.length>=2){return true}var h=[];for(var e=0;e<g.length;e++){h.push(g[e])}h.push(f);if(this.findChain(c-1,j-1,d,h)){return true}if(this.findChain(c-0,j-1,d,h)){return true}if(this.findChain(c+1,j-1,d,h)){return true}if(this.findChain(c-1,j+0,d,h)){return true}if(this.findChain(c+1,j+0,d,h)){return true}if(this.findChain(c-1,j+1,d,h)){return true}if(this.findChain(c+0,j+1,d,h)){return true}if(this.findChain(c+1,j+1,d,h)){return true}return false};b.prototype.getColorAt=function(c,d){if(c<0||d<0||c>=this.fieldWidth||d>=this.fieldHeight||!this.field[c][d]){return -1}return this.field[c][d].getColorID()};b.prototype.isValidCoords=function(c,d){return c>=0&&d>=0&&c<this.fieldWidth&&d<this.fieldHeight};b.prototype.onShiftEnded=function(c){if(!c){return}if(this.liveTime!=this.lastDropSoundTime){this.lastDropSoundTime=this.liveTime;var d=Utils.RandomRangeInt(0,2);while(d==this.lastDropID){d=Utils.RandomRangeInt(0,2)}this.lastDropID=d;switch(d){case 0:SoundManager.g_instance.play(SoundManager.SOUND_DROP_1);break;case 1:SoundManager.g_instance.play(SoundManager.SOUND_DROP_2);break;case 2:SoundManager.g_instance.play(SoundManager.SOUND_DROP_3);break}}};b.prototype.matchBonus=function(e,d,g,c){var f=e.getBonusType();if(e.isBonus()){e.clearBonus()}else{return}switch(f){case Chip.BONUS_COLOR:this.killColor(e);break;case Chip.BONUS_BOMB:this.boom(d,g,c);break;case Chip.BONUS_LINE_HOR:this.killHorLine(d,g);break;case Chip.BONUS_LINE_VERT:this.killVertLine(d,g);break}};b.prototype.killColor=function(f){SoundManager.g_instance.play(SoundManager.SOUND_LINE);var e=f.getColorID();if(e=-1){e=this.lastLineColor}var d=0;for(var c=0;c<this.fieldWidth;c++){for(var g=0;g<this.fieldHeight;g++){if(this.field[c][g]&&(this.field[c][g].getColorID()==e||e==-1)){d++;if(this.field[c][g].isBonus()){this.matchBonus(this.field[c][g],this.field[c][g].getIndexX(),this.field[c][g].getIndexY(),true)}else{this.field[c][g].match("",0,0.06*d)}}}}};b.prototype.killVertLine=function(c,e){SoundManager.g_instance.play(SoundManager.SOUND_LINE);this.addGameObjectAtPos(new KillLineEffect(new createjs.Point(0,+600)),this,this.getXPosByXIndex(c),this.getYPosByYIndex(e)-Constants.CELL_SIZE/2);this.addGameObjectAtPos(new KillLineEffect(new createjs.Point(0,-600)),this,this.getXPosByXIndex(c),this.getYPosByYIndex(e)-Constants.CELL_SIZE/2);for(var d=0;d<this.fieldHeight;d++){if(this.field[c][d]!=null){if(this.field[c][d].isBonus()){this.matchBonus(this.field[c][d],this.field[c][d].getIndexX(),this.field[c][d].getIndexY(),true)}else{this.field[c][d].match("",0,0.08*Math.abs(d-e))}}}};b.prototype.killHorLine=function(c,e){SoundManager.g_instance.play(SoundManager.SOUND_LINE);this.addGameObjectAtPos(new KillLineEffect(new createjs.Point(+600,0)),this,this.getXPosByXIndex(c),this.getYPosByYIndex(e)-Constants.CELL_SIZE/2);this.addGameObjectAtPos(new KillLineEffect(new createjs.Point(-600,0)),this,this.getXPosByXIndex(c),this.getYPosByYIndex(e)-Constants.CELL_SIZE/2);for(var d=0;d<this.fieldWidth;d++){if(this.field[d][e]!=null){if(this.field[d][e].isBonus()){this.matchBonus(this.field[d][e],this.field[d][e].getIndexX(),this.field[d][e].getIndexY(),true)}else{this.field[d][e].match("",0,0.08*Math.abs(d-c))}}}};b.prototype.boom=function(c,j,d){SoundManager.g_instance.play(SoundManager.SOUND_BOOM);var f=[[0,0,0,0,0],[0,1,1,1,0],[0,1,1,1,0],[0,1,1,1,0],[0,0,0,0,0]];var k=new AutoreleaseEffect("boom/",6,0.06);k.scaleX=k.scaleY=1.5;k.rotation=360*Math.random();this.addGameObjectAtPos(k,this.pointsLayer,this.getXPosByXIndex(c),this.getYPosByYIndex(j)-Constants.CELL_SIZE/2);for(var i=0;i<5;i++){for(var h=0;h<5;h++){if(f[i][h]!=0){var g=c+i-2;var e=j+h-2;if(this.isValidCoords(g,e)&&this.field[g][e]!=null){if(d){if(this.field[g][e].isBonus()){this.matchBonus(this.field[g][e],g,e,true)}else{this.field[g][e].match(Chip.REASON_BOMB,0,0)}}else{if(!this.field[g][e].isBonus()){this.field[g][e].match(Chip.REASON_BOMB,0,0)}}}}}}};b.prototype.addScore=function(c){var g=20+c.getNumInLine()*10;var f=new FlyingPoints(g);this.score+=g;var e=c.x;var d=c.y-Constants.CELL_SIZE/2;this.addGameObjectAtPos(f,this.pointsLayer,e,d)};b.prototype.restart=function(){StateManager.g_instance.pushState(new ShadeInState(new b(b.g_levelNum,true)))};b.prototype.pause=function(){this.onPauseClick()};b.GOAL_TYPE_KILL_BLACK="GOAL_TYPE_KILL_BLACK";b.GOAL_TYPE_CLEAR_CELLS="GOAL_TYPE_CLEAR_CELLS";b.GOAL_TYPE_MATCH="GOAL_TYPE_MATCH";b.MATCH_TYPE_JELLY="MATCH_TYPE_JELLY";b.MATCH_TYPE_BOMB="MATCH_TYPE_BOMB";b.MATCH_TYPE_VERTICAL="MATCH_TYPE_VERTICAL";b.MATCH_TYPE_HORIZONTAL="MATCH_TYPE_HORIZONTAL";b.MATCH_TYPE_COLOR="MATCH_TYPE_COLOR";b.STATE_WAIT_INPUT="STATE_WAIT_INPUT";b.STATE_WAIT_SPAWN="STATE_WAIT_SPAWN";b.STATE_SELECT_LINE="STATE_SELETC_LINE";b.STATE_SHIFT="STATE_SHIFT";b.STATE_MATCH="STATE_MATCH";b.g_levelNum=0;return b})(GameState);var ShowSplashTimeEffect=(function(b){__extends(a,b);function a(){b.call(this,Images.SPLASH_TIME);this.die=false;this.y=400;this.x=-350;createjs.Tween.get(this).wait(1800).to({x:350},600,createjs.Ease.backOut)}a.prototype.hide=function(){var c=this;createjs.Tween.get(this).to({scaleX:1.8,scaleY:1.8},500,createjs.Ease.backIn);createjs.Tween.get(this).wait(300).to({alpha:0},300,createjs.Ease.linear).call(function(){return c.kill()})};return a})(Skewer);var Skewer2=(function(a){__extends(b,a);function b(c){a.call(this);this.devider=Utils.RandomRange(0.9,1.1);this.clip=c}b.prototype.forceUpdate=function(c){a.prototype.forceUpdate.call(this,c);this.clip.skewX=Math.sin(this.forceLiveTime*4*this.devider)*8;this.clip.scaleY=1+Math.sin(this.forceLiveTime*8*this.devider)*0.08};return b})(GUIObject);var SplashTimeEffect=(function(a){__extends(b,a);function b(c){a.call(this);this.counter=c;this.liveTime=-3}b.prototype.update=function(c){a.prototype.update.call(this,c);if(this.liveTime>0.3){PlayState.g_instance.convertRandomChipToBonus();this.liveTime=0;if(--this.counter<=0){this.kill();PlayState.g_instance.runAllBonuses()}}};return b})(GameObject);var StatusPointsControl=(function(b){__extends(a,b);function a(f,g){b.call(this);this.smallPoints=new Array();this.offset=50;var e=this.offset*(f-1);for(var d=0;d<f;d++){var c=AssetsManager.g_instance.getCenteredImageWithProxy(Images.POINTS_CONTROL_SMALL);this.smallPoints.push(c);this.addChild(c);c.x=d*this.offset-e/2}this.bigPoint=AssetsManager.g_instance.getCenteredImageWithProxy(Images.POINTS_CONTROL_BIG);this.addChild(this.bigPoint);this.forcedSetActiveElement(g)}a.prototype.setActiveElement=function(d){if(this.curElement!=d&&d>=0&&d<this.smallPoints.length){this.bigPoint.scaleX=this.bigPoint.scaleY=0.5}else{return}for(var c=0;c<this.smallPoints.length;c++){this.smallPoints[c].visible=true}this.curElement=d;if(this.curElement<0){this.curElement=0}if(this.curElement>this.smallPoints.length-1){this.curElement=this.smallPoints.length-1}this.smallPoints[this.curElement].visible=false;this.bigPoint.x=this.smallPoints[this.curElement].x;this.bigPoint.y=this.smallPoints[this.curElement].y;this.bigPoint.scaleX=this.bigPoint.scaleY=0.5;createjs.Tween.get(this.bigPoint).to({scaleX:1,scaleY:1},300,createjs.Ease.backOut)};a.prototype.forcedSetActiveElement=function(c){this.setActiveElement(c);this.bigPoint.scaleX=this.bigPoint.scaleY=1};a.prototype.getActiveElement=function(){return this.curElement};return a})(createjs.Container);var TaskEffect=(function(b){__extends(a,b);function a(j,n){var i=this;b.call(this);this.showed=false;this.hidding=false;var c=AssetsManager.g_instance.getCenteredImageWithProxy(Images.TASK_CLOUD);this.addChild(c);this.jellier=new Jellier(c,12,0.2);this.alpha=0;createjs.Tween.get(this).wait(2500).to({alpha:1},350,createjs.Ease.linear).call(function(){return i.show()}).wait(3000).call(function(){return i.hide()});this.y=Constants.ASSETS_HEIGHT*0.45;this.x=Constants.ASSETS_WIDTH*0.5;var l=j.goal_type;var g=new DNTextField("0","score_font/",-7);c.addChild(g);var k="perfect_star";var f=1;var m=null;switch(l){case PlayState.GOAL_TYPE_CLEAR_CELLS:k=Images.DIRT_1;f=0.8;m=Images.TASK_CLEAR;break;case PlayState.GOAL_TYPE_KILL_BLACK:k=Images.EVIL_JELLY;f=0.9;m=Images.TASK_KILL;break;case PlayState.GOAL_TYPE_MATCH:switch(j.match_goal_type){case PlayState.MATCH_TYPE_BOMB:k=Images.ICON_BOMB;break;case PlayState.MATCH_TYPE_COLOR:k=Images.ICON_COLOR;break;case PlayState.MATCH_TYPE_VERTICAL:k=Images.ICON_VERT;break;case PlayState.MATCH_TYPE_HORIZONTAL:k=Images.ICON_HOR;break;case PlayState.MATCH_TYPE_JELLY:k="jelly_"+j.match_goal_id;f=1;break}m=Images.TASK_MATCH;break}var h=AssetsManager.g_instance.getCenteredImageWithProxy(k);c.addChild(h);h.y=+115;h.x=-35;g.x=50;g.y=+100;h.scaleX=h.scaleY=f;var d=AssetsManager.g_instance.getCenteredImageWithProxy(m);c.addChild(d);d.y=+10;var e=AssetsManager.g_instance.getCenteredImageWithProxy(Images.ICON_X);c.addChild(e);e.y=g.y+20;e.x=g.x-20;g.setText(n)}a.prototype.show=function(){this.showed=true};a.prototype.hide=function(){var c=this;if(!this.showed){return}if(this.hidding){return}this.hidding=true;createjs.Tween.removeTweens(this);createjs.Tween.get(this).to({scaleX:1.4,scaleY:1.4,alpha:0},400,createjs.Ease.backIn).call(function(){return c.kill()})};a.prototype.onMouseDown=function(c,d){this.hide()};a.prototype.forceUpdate=function(c){b.prototype.forceUpdate.call(this,c);if(this.forceLiveTime>2){this.jellier.update(c)}};return a})(GUIObject);var WinState=(function(b){__extends(a,b);function a(c,d){var k=this;b.call(this);this.panel=new createjs.Container();this.hiddingNow=false;this.tmpScore=0;this.tmpTotalScore=0;GameData.getInstance().onWinLevel(PlayState.g_levelNum,d,c);try{keyGamesAPI_sendScore(GameData.getInstance().getTotalScore());keyGamesAPI_levelEnd()}catch(l){}this.totalScore=GameData.getInstance().getTotalScore();this.score=d;this.tmpTotalScore=this.totalScore-d;if(this.tmpTotalScore<0){this.tmpTotalScore=0}if(this.totalScore<0){this.totalScore=0}if(this.score<0){this.score=0}this.shader=new createjs.Shape();this.shader.graphics.beginFill("#000000");this.shader.graphics.drawRect(0,0,Constants.ASSETS_WIDTH,Constants.SCREEN_HEIGHT);this.shader.graphics.endFill();this.addChild(this.shader);this.shader.alpha=0;createjs.Tween.get(this.shader).wait(300).to({alpha:0.4},800,createjs.Ease.linear);this.loadLayout(Layouts.WIN_WINDOW_LAYOUT,this);this.findGUIObject(Layouts.NAME_BUTTON_PLAY).setHandler(function(){return k.onPlayTouch()});this.findGUIObject(Layouts.NAME_BUTTON_MORE_GAMES).setHandler(function(){return k.onMoreGamesTouch()});this.findGUIObject(Layouts.NAME_BUTTON_EXIT).setHandler(function(){return k.onExitTouch()});this.findGUIObject(Layouts.NAME_BUTTON_LOGO).setHandler(function(){return Utils.goLogo()});this.scoreLabel=(this.findGUIObject("current_score"));this.totalScoreLabel=(this.findGUIObject("total_score"));this.totalScoreLabel.setText(Utils.ScoreString(this.tmpTotalScore));this.panel=this.findGUIObject(Layouts.NAME_PANEL);this.panel.alpha=0;createjs.Tween.get(this.panel).to({alpha:1},300,createjs.Ease.linear);this.addGameObject(new Jellier(this.panel,16,0));for(var h=1;h<=3;h++){var m=this.findGUIObject("perfect_"+h);var f=this.findGUIObject("perfect_"+h+"_empty");var j=null;if(h<=c){j=m;f.visible=false}else{j=f;m.visible=false}var g=200*h+500;j.scaleX=j.scaleY=0.1;createjs.Tween.get(j).wait(g).to({scaleX:1,scaleY:1},350,createjs.Ease.backOut).call(function(){return SoundManager.g_instance.play(SoundManager.SOUND_MATCH_1)});j.alpha=0;createjs.Tween.get(j).wait(g).to({alpha:1},300,createjs.Ease.linear)}}a.prototype.onMoreGamesTouch=function(){Utils.goMoreGames()};a.prototype.hide=function(){if(!this.hiddingNow){createjs.Tween.removeTweens(this.shader);createjs.Tween.get(this.shader).to({alpha:0},400,createjs.Ease.linear).call(function(){return StateManager.g_instance.popState()});createjs.Tween.get(this.panel).to({scaleX:1.3,scaleY:1.3},300,createjs.Ease.backIn);createjs.Tween.get(this.panel).to({alpha:0},300,createjs.Ease.linear);this.hiddingNow=true}};a.prototype.update=function(c){b.prototype.update.call(this,c);if(this.liveTime>1.5){this.tmpScore+=Math.round(c*this.score*2);if(this.tmpScore>this.score){this.tmpScore=this.score}this.scoreLabel.setText(Utils.ScoreString(this.tmpScore))}if(this.liveTime>2){this.tmpTotalScore+=Math.round(c*this.score*2);if(this.tmpTotalScore>this.totalScore){this.tmpTotalScore=this.totalScore}this.totalScoreLabel.setText(Utils.ScoreString(this.tmpTotalScore))}};a.prototype.onRestartTouch=function(){StateManager.g_instance.pushState(new ShadeInState(new PlayState(PlayState.g_levelNum,true)))};a.prototype.onPlayTouch=function(){if(PlayState.g_levelNum+1>=GameData.getTotalLevels()){StateManager.g_instance.pushState(new ShadeInState(new SelectLevelState()))}else{StateManager.g_instance.pushState(new ShadeInState(new PlayState(PlayState.g_levelNum+1)))}};a.prototype.onExitTouch=function(){StateManager.g_instance.pushState(new ShadeInState(new SelectLevelState()))};return a})(GameState);
